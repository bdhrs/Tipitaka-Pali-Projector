<!DOCTYPE html>
<html>
<head>
    <title></title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="TIPITAKA PROJECTOR ICON" href="images/favico.ico" />
    <link rel="stylesheet" type="text/css" href="js/index_style.css" />
    <link rel="stylesheet" type="text/css" href="js/index_style2.css" />
    <link rel="stylesheet" type="text/css" href="css/js.tree.style.min.css" />
    <link rel = "stylesheet" type="text/css" href="js/jquery-ui-1.12.1/jquery-ui.css" />
    
    <style>
        .app-dialog {
            display: none;
        }
    </style>

    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
    <script src="js/jquery-ui-1.12.1/jquery-ui.js"></script>
    <script src="js/jstree.js"></script>

    <script>
        var UseSinglePageLoading = true;
        var DEBUG = true;

        var bookData = {
            structure: {},
            flat: {}
        };

        $.jstree.defaults.core.themes.variant = 'large';

        const setBookInfo = (rawBookMetaData) => {
            const structuredData = JSON.parse(rawBookMetaData).books;
            
            for (const book of structuredData) {
                for (const set of book.sets) {
                    for (const text of set.texts) {
                        const extraInfo = {set: set.name, book: book.name};
                        bookData.flat[text.bookId] = Object.assign(extraInfo, text);
                    }
                }
            }
            
            const treeData = structuredData.map(sd => {
                return {
                    text: sd.name,
                    children: sd.sets.map(set => {
                        return {
                            text: set.name,
                            children: set.texts.map(text => {
                                return {
                                    text: text.title,
                                    icon: 'images/text.png',
                                    data: text
                                }
                            })
                        }
                    })
                }
            });

            $('#books-tree').jstree({core: {data: treeData}});

            $('#books-tree').on('select_node.jstree', (event, data) => {
                if (data && data.node && data.node.data) {
                    // this is actual text
                    //
                    const bookInfo = data.node.data;
                    loadBook(bookInfo.bookId);
                } else {
                    // this is an expandable entity (e.g. a book)
                    //
                    data.instance.toggle_node(data.selected);
                }
            });

            $('#index').dialog({autoOpen: false, maxHeight: $(window).height()});
            
            const width = () => $(window).width() - 40;
            const height = () => $(window).height() - 40;

            $('#search').dialog({
                autoOpen: false, 
                resizable: false,
                draggable: false,

                minWidth: width(),
                minHeight: height(),

                maxHeight: width(),
                maxWidth: height(),

                open: function() {
                    $(this).dialog('option', {minWidth: width(), maxWidth: width(), minHeight: height(), maxHeight: height()});
                }
            });
            
        };
        
        var showIndex = function showIndex() {
            $('#index').dialog('open');
        };
        
        var showDialog = function showDialog(dialogId) {
            $(dialogId).dialog('open');
        };

        $.ajax({
            url: 'books.json',
            dataType: "text",
            type: "GET",
            mimeType: 'text/json; charset=utf-8',
            contentType: 'text/json; charset=UTF-8',
            success: setBookInfo
        });
    </script>
</head>

<body style="background-color: black; margin-top:0.0pt;margin-right:0in;margin-bottom:0in;margin-left:0in;margin-bottom:0pt;">
<div id="main_div">

  <!-- These are the tabs styles, they should for now be here for easier editing but eventually moved to a .css file -->
  <style>
    @font-face {
      font-family: 'Material Icons';
      font-style: normal;
      font-weight: 400;
      src: url(./fonts/material/MaterialIcons-Regular.eot); /* For IE6-8 */
      src: local('Material Icons'),
      local('MaterialIcons-Regular'),
      url(./fonts/material/MaterialIcons-Regular.woff2) format('woff2'),
      url(./fonts/material/MaterialIcons-Regular.woff) format('woff'),
      url(./fonts/material/MaterialIcons-Regular.ttf) format('truetype');
    }

    .material-icons {
      font-family: 'Material Icons';
      font-weight: normal;
      font-style: normal;
      font-size: 24px;  /* Preferred icon size */
      display: inline-block;
      line-height: 1;
      text-transform: none;
      letter-spacing: normal;
      word-wrap: normal;
      white-space: nowrap;
      direction: ltr;

      /* Support for all WebKit browsers. */
      -webkit-font-smoothing: antialiased;
      /* Support for Safari and Chrome. */
      text-rendering: optimizeLegibility;

      /* Support for Firefox. */
      -moz-osx-font-smoothing: grayscale;

      /* Support for IE. */
      font-feature-settings: 'liga';
    }
    .first-nav {
      margin-bottom: 5px;
      padding-top: 5px;
      line-height: 1;
    }
    .helpers {
      position: sticky;
      top: 0;
      padding-top: 10px;
    }
    .helpers > * {
      display: none;
    }
    .tabs {
      position: absolute;
      z-index: 1000;
      left: 5px;
      right: 0;
      height: 32px;
    }
    #main_div .tabs > li {
      border: 2px solid #00000024;
      padding: 0 10px;
      line-height: 32px;
      float: left;
      border-bottom: 0;
      border-top-left-radius: 5px;
      border-top-right-radius: 5px;
      margin-right: 5px;
      color: #555;
      text-decoration: none;
      font-size: 14px;
      position: relative;
      height: 30px;
      user-select: none;
      background-color: transparent;
      font-weight: normal;
      font-family: sans-serif;
    }
    #main_div .tabs > li.selected {
      border-color: #777;
      height: 32px;
      /* background-color: #fafafa;*/
      font-weight: bold;
    }
    .tab-content {
      /* background-color: #fafafa;*/
      border: 2px solid #777;
      border-bottom-left-radius: 10px;
      border-bottom-right-radius: 10px;
      margin-top: 32px;
      float: left;
      width: 100%;
      box-sizing: border-box;
      font-family: sans-serif;
      overflow-y: scroll;
      position: relative;
      padding: 0 10px 10px;
    }
    #main_div li {

    }
    .grey-button {
      box-shadow:inset 0px 1px 0px 0px #ffffff;
      /*      background: linear-gradient(to bottom, #ededed 5%, #dfdfdf 100%);
            background-color: #ededed;*/
      border-radius: 5px;
      border: 1px solid #aaa;
      cursor:pointer;
      color:#777;
      line-height: 1;
      text-decoration:none;
      text-shadow:0px 1px 0px #ffffff;
      display: inline-block;
      width: 36px;
      height: 36px;
      overflow: hidden;
      text-align: center;
    }
    .grey-button.letter {
      line-height: 36px;
      font-family: sans-serif;
      font-size: 18px;
    }
    .grey-button.letter.selected {
      font-weight: bold;
    }
    .grey-button i {
      margin: 5px;
    }
    .grey-button span {
      width: 24px;
      height: 24px;
      margin: 5px;
      font-weight: bold;
      display: inline-block;
      line-height: 24px;
      text-align: center;
    }
    .grey-button:hover {
      background:linear-gradient(to bottom, #dfdfdf 5%, #ededed 100%);
      background-color:#dfdfdf;
    }
    .grey-button:active {
      position:relative;
      top:1px;
    }

    .sep {
      margin-left: 5px;
      margin-right: 5px;
      width: 1px;
      display: inline-block;
      height: 23px;
      background: #aaa;
      margin-bottom: 5px;
    }
    .generous-input {
      font-size: 16px;
      margin-left: 5px;
      margin-right: 5px;
      padding: 3px;
    }
    .input-label {
      font-size: 14px;
    }
    .search-area {
      display: flex;
      margin-top: 5px;
      align-items: center;
    }
    .search-area i {
      border-radius: 50%;
      background: #fff;
      border: 1px solid #b3b3b3;
      color: #515151;
      width: 24px;
      height: 24px;
      overflow: hidden;
      user-select: none;
    }
    .search-area i:hover {
      border-color: #aaa;
      color: #000;
    }
    .DictionaryClass {
      background-color: rgba(176, 176, 176, 0.42) !important;
    }
    .dict {
      font-family: sans-serif;
    }
    .dictionary-item {
      display: inline-block;
      white-space: nowrap;
    }
    #TmpDictionary:after {
      content: "";
      clear: both;
      display: table;
    }
    header.panel-header {
      height: 30px;
      width: calc(100% + 10px);
      display: flex;
      font-family: sans-serif;
      align-items: center;
      border-bottom: 3px solid #777;
      margin-left: -5px;
      padding-left: 5px;
      cursor: grab;
      user-select: none;
    }
    header.panel-header * {
      display: flex;
    }
    header.panel-header img {
      margin-right: 5px;
    }

    #ResizeLeft{
      width:10px;
      height:100%;
      position:absolute;
      left: -8px;
      top:0;
      cursor: e-resize;
      overflow:hidden;
      z-index:3;
    }
    #ResizeTop{
      width:100%;
      height:10px;
      position:absolute;
      left:0;
      right: 0;
      top: -8px;
      cursor:n-resize;
      overflow:hidden;
      z-index:3;
    }
    .lookup-result {
      font-weight: bold;
      color: dodgerblue;

    }
    .lookup-result:hover {
      text-decoration: underline;
    }
  </style>

  <header class="panel-header" id="panel-header">
    <img src="images/dhammacakka.svg"height="22" width="22" />
    <span>Tipiṭaka  Pāḷi Projector</span>
  </header>

  

  <div class="first-nav">
    <!-- HOME -->
    <div class="notselected grey-button" onClick="showIndex()" title="Home">
      <i class="material-icons">home</i>
    </div>

    <!-- SEARCH -->
    <div class="notselected grey-button" onClick="showDialog('#search')" title="Seach">
      <i class="material-icons">search</i>
    </div>

    <!-- PREFERENCES -->
    <div class="notselected grey-button" onClick="window.location.href='preferences.htm'" title="Preferences">
      <i class="material-icons">settings</i>
    </div>

    <span class="sep"></span>

    <div class="notselected grey-button letter" id="Pali1" title="Mūla" onClick="MATurlGo('1')">
      M
    </div>

    <div class="notselected grey-button letter" id="Pali2" title="Aṭṭhakathā" onClick="MATurlGo('2')">
      A
    </div>

    <div class="notselected grey-button letter" id="Pali3" title="Ṭīkā" onClick="MATurlGo('3')">
      T
    </div>

  </div>

  <div class="dict">

    <span id="message" style="font-size:10pt;" title="Id=Id-No. Para=Paragraph No. M=Myanmar PageNo. P=PTS PageNo."></span>

    <div id="TmpDictionary" style="display:inline;margin-left:10px; margin-top: 5px;">
    </div>
  </div>

  <ul class="tabs">
    <li class="selected" id="page1" onclick="onTabClick(this)" data-helper="dict">
      Dict.
    </li>

    <li class="notselected" id="page2" onclick="onTabClick(this);" data-helper="decl">
      Decl.
    </li>

    <li class="notselected" id="page3" onclick="onTabClick(this);">
      Par.
    </li>

    <li class="notselected" id="page4" onclick="onTabClick(this);">
      Nav.
    </li>

    <li class="notselected" id="page5" onclick="onTabClick(this);">
      Misc.
    </li>
  </ul>

  <script>
    const onTabClick = (tab) => {
      // hide all helpers
      //  For consistent UI, the temp dictionary listings and location will be shown all the time
      // following line hides these
      $('.helper').hide();

      // show a helper associated with the tab
      //
      if (tab.dataset.helper) {
        $(`.helper.${tab.dataset.helper}`).show();
      }
      change_tab(tab.id);
      if (tab.id === 'page3') {
        ParagraphAnalysis();
      }
    };
    $('.helper.dict').show();
  </script>

  <div class="tab-content" id="tab-content">
    <div class="helpers">
      <div class="helper dict">
        <div class="search-area">
          <i onClick="paliGoBack()" class="material-icons">arrow_back</i>&nbsp;&nbsp;
          <span>&nbsp;Pāḷi:&nbsp;</span>
          <input type="textbox" class="generous-input" style="max-width:85%;width:85pt;display:inline;" id="DictionaryKey" name="DictionaryKey">

          <!-- just display:none a wrapped "GO" button for now so it remains in the DOM and won't break JS.. -->
          <div style="display: none">
            <input type="button" value="Go" onClick="DictionaryKeyGo();" id="GoDictionary">
          </div>

          <span>&nbsp;Algo:&nbsp;&nbsp;</span>
          <select id="algorithm-selector" >
            <option value="auto">Auto</option>
            <option value="dpr">DPR</option>
            <option value="tpp">TPP</option>
            <option value="none">None</option>
          </select>
          <script>
            // defaults to auto
            //
            const currentAlgo = localStorage.getItem('tpp-breakup-algo') || 'auto';

            const $algoSelect = $('#algorithm-selector');
            $algoSelect.find('option').removeAttr('selected');
            $algoSelect.find('option[value="' + currentAlgo + '"]').attr('selected', 'selected');
            $algoSelect.on('change', function() {
              localStorage.setItem('tpp-breakup-algo', this.value);
              // refresh the dictionary lookup
              //
              DictionaryGo();
            });
          </script>

        </div>
        <div id="lookup-results">

        </div>
        <script>
          const $lookupResults = $('#lookup-results');
          $lookupResults.on('click', '.lookup-result', function() {
            $lookupResults.empty();
            $('#DictionaryKey').val(this.dataset.word);
            DictionaryGo();
          });
          const performLookup = (val) => {
            const lookupResults = WordListLookup(val);
            $lookupResults.empty();
            let resultHTML = '';
            for (const result of lookupResults) {
              resultHTML += '<div class="lookup-result" data-word="' + result + '">' + result + '</div>';
            }
            $lookupResults.html(resultHTML);
          };

          let debounceTimeout;
          $('#DictionaryKey').on('input', function() {
            clearTimeout(debounceTimeout);
            const value = this.value;
            debounceTimeout = setTimeout(() => { performLookup(value); }, 300);
          })
        </script>
      </div>


      <div class="helper decl">
        <input type="textbox" style="max-width:85%;width:85pt;display:none;" id="DeclensionKey" name="DeclensionKey" onKeyup="DeclensionSearch();">
        <input type="button" value="Go" onClick="DictionaryKeyGo();" id="GoDeclension" style="display:none;">
      </div>
    </div>

    <div id="main_content" style="padding-top:5px; width:100%;">
      <div id="page1_desc" class="pages" style="max-height: 80%;height: 80%;overflow-y: scroll;">
        Sukhi Hontu!
      </div>

      <div id="page2_desc" class="pages2" style="display:none;padding-top: 1px;overflow-x:auto;overflow-y: auto;width:100%;">

        <span id="DeclensionTips2" class="DeclensionSelect"></span>

        <div id='DeclensionResult' class="DeclensionResult"></div><br>

        <img src="images/s_info.png" onMouseover="document.getElementById('info').style.display='inline';" onMouseout="document.getElementById('info').style.display='none';">
        <span id="info" style="display:none;font-size:11pt;">
            Velthuis Pali Letters,&nbsp;&nbsp;Wildcard Search, Ex:*sa, *sa*
          </span>
        <br><br>
      </div>

      <div id="page3_desc" class="pages" style="display:none;overflow-y:none;">
        <div id='ParagraphDictionary'>
        </div>
      </div>
      <input type="hidden" id="ParagraphWords" value="">

      <div id="page4_desc" class="pages2" style="display:none;align:center;">
        <div class="page4" style="line-height: 250%;">
          <select name="Toc" id="Toc" onchange="goToc();">
          </select>
          <span id="page4break1"></span>

          <input name="Reference" id="Pgnum" value="0" type="radio" checked>
          <label for="Pgnum" >Page...</label>
          <input name="Reference" id="Prnum" value="1" type="radio">
          <label for="Prnum" >Paragraph...</label>
          <span id="page4break2"></span>

          <input name="Reference" id="PTS" value="2" type="radio">
          <label for="PTS" >PTS No...</label>
          <input type="Textbox" name="PageNo" id="PageNo" value="" style="font-size:11pt;width:100%;max-width:40pt;" onBlur="goUrl()">
          <br>

          <div style="line-height: 110%;">
            <div onClick="document.getElementById('QuickJumpTipsShow').style.display='inline';" style="color:blue;">
              <img src="images/s_info.png">Tips
            </div>
            <div id="QuickJumpTipsShow" onClick="this.style.display='none'" style="color:#440000;font-size:11pt;display:none;">[sn1 99]= Jump to sn1 Paragraph 99,<br>[sn1 m99]= Jump to sn1 Myanmar Page 99,<br>[sn1 p99] or [sn1 pts99]= Jump to sn1 PTS Page 99.<br>
            </div>
          </div>
          Quick Jump
          <input type="Textbox" name="QuickJump" id="QuickJump" value="" style="font-size:11pt;width:100%;max-width:60pt;" onBlur="QuickJump()" onKeyup="QuickJumpTips()">
          <input id="QuickJumpNewTab" type="checkbox" value="0"></input>
          <label for="QuickJumpNewTab">Open at New Tab</label><br>
          <span id="QuickJumpTips" style="color:#440000;"></span>
        </div>
        <span id="page4break3"></span>

        <div class="page4">
          <img src='images/b_browse.png'>History
          <span id='palihistory' style="font-size:10pt;color:blue;"></span>&nbsp;&nbsp;
        </div>
      </div>

      <div id="page5_desc" class="pages2" style="display:none;">
        <div class="page5">
          <img src='images/b_browse.png'>Dictionary History
          <span id='dicthistory' style="font-size:11pt;color:blue;"></span>&nbsp;&nbsp;
        </div>
        <span id="page5break1"></span>

        <div class="page5">
          <img src='images/b_ftext.png' width="24">Copy Text
          &nbsp;
          <span id="copystart" onClick="CopyExport(1)" style="font-size:10pt;color:blue">
              <img src="images/change.png" width="22">&nbsp;Start Selection
              <input type="hidden" id="copy1" value="">
            </span>
          <span id="copyunformat" onClick="CopyExport(2)" style="display:none;font-size:10pt;color:blue">
              <img src="images/b_sbrowse.png" width="22">&nbsp;UnFormat TXT
              <input type="hidden" id="copy2" value="">
              <input type="hidden" id="copystatus" value="stop">
            </span>
          <span id="copyformat" onClick="CopyExport(3)" style="display:none;font-size:10pt;color:blue">
              <img src="images/b_report.png" width="22">&nbsp;Format HTML
              <input type="hidden" id="copy3" value="">
            </span>
          <span id="copycancel" onClick="CopyExport(0)" style="display:none;font-size:10pt;color:blue">
              <img src="images/s_cancel.png" width="22">&nbsp;Cancel
            </span>
          <br>
          <textarea id='CopyText' style='width:95%;max-width:95%;max-height:95%; height:70%;overflow:hidden;resize:none;'></textarea>
        </div>
        <span id="page5break2"></span>

        <div class="page5">
          <table style="border-collapse:collapse;padding:5px;width:100%;height:100%; border:0px;">
            <tr>
              <td valign="top" width="50%">
                <input type="hidden" id="mynote1" value="">
                <input type="hidden" id="mynoteids" value="">
                <input type="hidden" id="mynotetags" value="">
                <input type="hidden" id="mynoteolds" value="">

                <span id="mynote5" onClick="MyNoteExport(5)" style="font-size:12pt;color:blue;margin-bottom:10px">
                    <img src="images/add_point_on.png" width="22">Edit 5 Par.<br><br>
                  </span>
                <span id="mynotesave" onClick="MyNoteExport(1)" style="display:none;font-size:12pt;color:blue">
                    <img src="images/save.png" width="22">Save<br><br>
                  </span>

                <span id="mynote10" onClick="MyNoteExport(10)" style="font-size:12pt;color:blue;margin-bottom:10px">
                    <img src="images/add_point_on.png" width="22">Edit 10 Par.<br><br>
                  </span>
                <span id="mynotecancel" onClick="MyNoteExport(0)" style="display:none;font-size:12pt;color:blue">
                    <img src="images/s_cancel.png" width="22">&nbsp;Cancel
                  </span>

                <span id="mynote20" onClick="MyNoteExport(20)" style="font-size:12pt;color:blue">
                    <img src="images/add_point_on.png" width="22">Edit 20 Par.
                  </span>

              </td>
              <td valign="top" width="50%">
                  <span onClick="AnkiAdd()" style="font-size:12pt;color:blue">
                    <select id="AnkiDictionary">
                    </select>
                    <img src="images/b_group.png" width="22">Add to Anki
                  </span>
                <br><br>

                <span onClick="AnkiCopy()" style="font-size:12pt;color:blue">
                    <img src="images/s_okay.png" width="22">Copy
                  </span>
                <br><br>

                <span onClick="AnkiClear()" style="font-size:12pt;color:blue">
                    <img src="images/b_drop.png" width="22">Clear
                  </span>
              </td>
            </tr>
          </table>

        </div>
      </div>
    </div>
  </div>


  <div style="display:inline;margin-left:10px; margin-top: 50px; width:100%;">
    <div id="iPad" style="display:inline">
      <select id="iPadDirection" onchange="iPadDirection()">
        <option value="NW">Top-Left</option>
        <option value="NE">Top-Right</option>
        <option value="SE">Bottom-Right</option>
        <option value="SW">Bottom-Left</option>
      </select>
      <span id="iPadW">W</span>
      <select id="iPadWidth" onchange="iPadWidth()">
        <option value=""></option>
      </select>
      <span id="iPadH">H</span>
      <select id="iPadHeight" onchange="iPadHeight()">
        <option value=""></option>
      </select>
    </div>

    <style>
      #PC * {
        user-select: none;
        -moz-user-select: none;
      }
    </style>

    <div id="PC" style="display:inline">
      <div id="divDragIcon" style="
        z-index:3;
        overflow: hidden;
        position: absolute;
        bottom: 5px;
        width: 24px;
        height:24px;">
        <img src="images/drag.png">
      </div>
      <div id="ResizeDrag"><img src="images/resize.png" width="35"></div>
    </div>
  </div>

  <div id="ResizeRight"></div>
  <div id="ResizeBottom"></div>

  <div id="ResizeLeft"></div>
  <div id="ResizeTop"></div>


  <script>
    var doAdjustTabContent = function() {
      const tc = document.getElementById('tab-content');
      const md = document.getElementById('main_div');

      const mainRect = md.getBoundingClientRect();
      const contentRect = tc.getBoundingClientRect();

      if (mainRect.width === 0 || mainRect.height === 0 || contentRect.height === 0 || contentRect.width === 0) {
        setTimeout(function() { adjustTabContent(); }, 300);
      } else {
        const availableHeight = mainRect.height - contentRect.top + mainRect.top - 42;
        tc.style.height = `${availableHeight}px`;
      }
    };
    var adjustTabContent = function adjustTabContent(immediately) {
      if (immediately) {
        doAdjustTabContent();
      } else {
        setTimeout(function () {doAdjustTabContent()}, 0);
      }
    };
  </script>
  <script>
    var interfaceFlags = {
      movePanel: false,
      resizeLeft: false,
      resizeTop: false
    };
    var moveInfo = {
      movePanel: {x: 0, y: 0},
      resizeLeft: {x: 0, y: 0},
      resizeTop: {x: 0, y: 0},
    };
    const panelHeader = document.getElementById('panel-header');
    const leftResizeArea = document.getElementById('ResizeLeft');
    const topResizeArea = document.getElementById('ResizeTop');

    const getMovement = function(which, e) {
      if (e.movementX !== undefined) {
        return {
          x: e.movementX,
          y: e.movementY
        }
      }

      // This all is handling touches rather than mouse input:
      //

      const cx = e.touches && e.touches[0].clientX || 0;
      const cy = e.touches && e.touches[0].clientY || 0;

      const mx = cx - moveInfo[which].x;
      const my = cy - moveInfo[which].y;

      moveInfo[which].x = cx;
      moveInfo[which].y = cy;

      return {x: mx, y: my};
    };

    var onPanelMove = function(e) {
      if (interfaceFlags.movePanel === false) {
        return;
      }

      const mainDivBox = panelHeader.parentElement.getBoundingClientRect();
      const box = panelHeader.parentElement.getBoundingClientRect();

      const movement = getMovement('movePanel', e);

      const nextX = Math.min(window.innerWidth - mainDivBox.width, Math.max(0, movement.x + box.x));
      const nextY = Math.min(window.innerHeight - mainDivBox.height, Math.max(0, movement.y + box.y));

      panelHeader.parentElement.style.left = `${nextX}px`;
      panelHeader.parentElement.style.top = `${nextY}px`;
    };

    var onResizeLeft = function onResizeLeft(e) {
      if (interfaceFlags.resizeLeft === false) {
        return;
      }
      e.stopPropagation();
      e.preventDefault();
      const mainDivBox = panelHeader.parentElement.getBoundingClientRect();
      // -20 because box-sizing is not border-box and has padding etc
      const currentWidth = mainDivBox.width - 20;
      const currentLeft = mainDivBox.left;

      const movement = getMovement('resizeLeft', e);

      const nextLeft = Math.max(0, currentLeft + movement.x);
      const delta = nextLeft - currentLeft;
      const nextWidth = currentWidth - delta;

      panelHeader.parentElement.style.left = `${nextLeft}px`;
      panelHeader.parentElement.style.width = `${nextWidth}px`;
    };

    var onResizeTop = function onResizeLeft(e) {
      if (interfaceFlags.resizeTop === false) {
        return;
      }
      e.stopPropagation();
      e.preventDefault();
      const mainDivBox = panelHeader.parentElement.getBoundingClientRect();
      // -36.667 because box-sizing is not border-box and has padding etc
      const currentHeight = mainDivBox.height - 36.667;
      const currentTop = mainDivBox.top;

      const movement = getMovement('resizeTop', e);
      const nextTop = Math.max(0, currentTop + movement.y);
      const delta = nextTop - currentTop;
      const nextHeight = currentHeight - delta;

      panelHeader.parentElement.style.top = `${nextTop}px`;
      panelHeader.parentElement.style.height = `${nextHeight}px`;

      adjustTabContent(true);
    };

    const onMove = function(e) {
      if (interfaceFlags.movePanel) {
        onPanelMove(e);
      } else if (interfaceFlags.resizeLeft) {
        onResizeLeft(e);
      } else if (interfaceFlags.resizeTop) {
        onResizeTop(e);
      }
    };

    document.addEventListener('mousemove', onMove);
    document.addEventListener('touchmove', onMove);

    const down = function(which, e) {
      if (localStorage.getItem('contentposition') === '0') {
        interfaceFlags[which] = true;
        moveInfo[which] = {
          x: e.clientX || e.touches[0].clientX,
          y: e.clientY || e.touches[0].clientY
        };
        e.stopPropagation();
        e.preventDefault();
      }
    };

    // panel
    panelHeader.addEventListener('mousedown', function(e) {down('movePanel', e)});
    panelHeader.addEventListener('touchstart', function(e) {down('movePanel', e)});

    leftResizeArea.addEventListener('mousedown', function(e) {down('resizeLeft', e)});
    leftResizeArea.addEventListener('touchstart', function(e) {down('resizeLeft', e)});

    topResizeArea.addEventListener('mousedown', function(e) {down('resizeTop', e)});
    topResizeArea.addEventListener('touchstart', function(e) {down('resizeTop', e)});

    const onUp = function() {
      if (interfaceFlags.movePanel === true) {
        interfaceFlags.movePanel = false;
      } else if (interfaceFlags.resizeLeft === true) {
        interfaceFlags.resizeLeft = false;
      } else if (interfaceFlags.resizeTop === true) {
        interfaceFlags.resizeTop = false;
      }
      document.body.removeEventListener('mousemove', onPanelMove);
      document.body.removeEventListener('touchmove', onPanelMove);

      document.body.removeEventListener('mousemove', onResizeLeft);
      document.body.removeEventListener('touchmove', onResizeLeft);

      document.body.removeEventListener('mousemove', topResizeArea);
      document.body.removeEventListener('touchmove', topResizeArea);
    };
    document.addEventListener('mouseup', onUp);
    document.addEventListener('touchend', onUp);

  </script>
</div>


<div id="main_td2" class="main_td2">
    <div id="loader" style="z-index: auto;"></div>
    <table id="main_table" bgcolor="#010101" width=100% border=0 align="left" cellspacing=3 cellpadding=7 style="padding-left: 15px;">


    </table>
    <script type="text/javascript">
        var loadBook = function loadBook(bookId) {
            var bookInfo = bookData.flat[bookId];
            var start = new Date();
            if (DEBUG) {
                console.log(start);
                console.log('Loading book:', bookInfo);
            }
            if (!bookInfo) {
                return;
            }
            
            // Set the document/window title
            //
            document.title = bookInfo.title;

            // Empty the table showing the book contents in case
            // it was showing another book previously
            //
            var $table = $('#main_table');
            $table.empty();

            // Create empty rows to be filled with the book content later on
            //
            var rows = '';
            for (var i = 1; i <= bookInfo.rows; i++) {
                var row = "<tr><td class='r1' id='p" + i + "'></td><td class='m1' id='m" + i + "'></td></tr>";
                rows += row;
            }
            $table.html(rows);
            
            // These are the book .js files
            //
            var bookMetaFile = 'pali/' + bookId + '.js';
            var bookParagraphsFile = 'pali/' + bookId + 'a.js';
            
            if (DEBUG) {
                console.log('Will load book contents:', [bookMetaFile, bookParagraphsFile].map(e => `'${e}'`).join(', '));
            }

            start = new Date();
            loadInSequence([bookMetaFile, bookParagraphsFile], function onDone() {
                if (DEBUG) {
                    console.log('Loaded book contents in ' + (new Date().getTime() - start.getTime()) + ' ms.');
                }

                // at this point both files should be loaded so we can display
                // the contents, but first set the chapter name:
                //
                setHistoryItemChapterName();
                
                // Set the table styling before filling the content of the book 
                // to avoid repaint
                //
                setTableStyling();
                
                // Load the book text content, paragraph data etc
                //
                displayBook();
            });
        }
    </script>
</div>

<div id="Sr_Div" style="display:scroll;position:fixed;top:110px;right:0px;visibility:hidden;z-index:99;max-height:90px;width:100px;text-align: center;padding:3px;margin-left:1%;margin-right:1%;background:#F7DBD0;color:black;border:1px dashed orange;border-radius:3px;-moz-border-radius:3px;-webkit-border-radius:3px;-o-border-radius:3px;">
    <img src="images/b_drop.png" width="20" height="20" onClick="Sr_Go('0')">
    <br>
    <img src="images/b_prevpage.png" width="25" height="40" onClick="Sr_Go('1')">
    &nbsp;
    <img src="images/b_nextpage.png" width="25" height="40" onClick="Sr_Go('2')">
    <br>
    <span id="Sr_Now">0</span>
    &nbsp;/&nbsp;
    <span id="Sr_Next">999</span>
</div>

<popupfix></popupfix>

<script type="text/javascript">
    var scriptsToLoad = [
        'jquery_stlookup.js',
        'function0_main.js',
        'function0_main_content.js',
        'function1_dictionary.js',
        'function2_declension.js',
        'function3_paragraph.js',
        'function4_TOC.js',
        'function5_copy.js',
        'function5_history.js',
        'function5_mynote.js',
        'function5_anki.js',
        'z_tipitaka_Maps.js',
        'z_search_navigator.js'
    ];

    // This is a global jQuery getString override.
    // It's used in other external .js files loaded after the main content, for example function0_main.js
    // It's very important to have it so that this works in Firefox browsers
    $.getScript = function(fileToLoad) {
        $.ajax({
            url: fileToLoad,
            dataType: "script",
            type: "GET",
            mimeType: 'text/plain; charset=utf-8',
            contentType: 'text/javascript; charset=UTF-8',
            success: function(data) {
                jQuery.globalEval(data);
            }
        });
    };

    var addScriptToBody = function addScriptToBody(path) {
        var scriptTag = document.createElement('script');
        scriptTag.setAttribute('type', 'text/javascript');
        scriptTag.setAttribute('src', path);
        document.body.appendChild(scriptTag);
    };

    var addScriptToHead = function addScriptToHead(path) {
        var scriptTag = document.createElement('script');
        scriptTag.setAttribute('type', 'text/javascript');
        scriptTag.setAttribute('src', path);
        document.head.appendChild(scriptTag);
    };

    var scriptsLength = scriptsToLoad.length;
    var head = document.getElementsByTagName('head')[0];
    for (var i = 0; i < scriptsLength; i++) {
        addScriptToBody('js/' + scriptsToLoad[i]);
    }
</script>


<popupfix></popupfix>
<!---End of add dictionary function--->

<div id="index" title="Books Index" class="app-dialog">
    <div id="books-tree"></div>
</div>

<div id="search" title="Search" class="app-dialog">
<table align="center" bgcolor="#ffffc0" border="0" width="100%" cellpadding="0" cellspacing="0">
	<tbody>
		<tr>
			<td width="2%"></td>
			<td align="right" valign="center" width="10%">
				<a href="index.htm">
					<img src="images/asoka.png">
				</a>
			</td>
			<td align="center" width="76%">
				<span style='line-height:140%;color:brown;font-size:15pt;'><b>Tipiṭaka Pāḷi Projector</b></span> - 20200330 (TG)

				<hr style="border: 1pt dashed gray; width:50%;"> 
				Entry <a href="#Velthuis" onClick="Velthuis()" title="Show Velthuis">
				<span style="color:blue;">Velthuis Pali</span></a> word&nbsp;
				<input type="textbox" name="key" id="key" style="font-size:12pt;width:100%;max-width:280px;" onkeyup="Keyin()" value="">
				<input type="hidden" id="id1">
				<input type="hidden" id="id2">
				<table border="0" width="70%">
					<tr>
						<td width="20%" align="right">
							Search in :&nbsp;
						</td>	
						<td width="70%">
							<input name="SearchType" id="SearchType1" type="radio" onChange="SetSelect();Keyin()" checked>
          					<label for="SearchType1" style="color:blue;font-size:12pt;">&nbsp;Tipiṭaka&nbsp;</label>
          				
          				
							<input type="submit" onClick="Start_Fuzzy()" name="Submit" value="Fuzzy">&nbsp;&nbsp;
							<input type="submit" onClick="Start_Exact()" name="Submit" value="Exact">&nbsp;&nbsp;
							<input type="submit" onClick="Start_Prefix()" name="Submit" value="Prefix">&nbsp;&nbsp;
							<input type="submit" onClick="Start_Suffix()" name="Submit" value="Suffix"><br>
						</td>
						<td width="10%"></td>
					</tr>
					<tr>
						<td></td>
						<td>
      						<input name="SearchType" id="SearchType2" type="radio" onChange="SetSelect();Keyin()">
          					<label for="SearchType2" style="color:blue;font-size:12pt;">&nbsp;Fuzzy Title&nbsp;</label>
      						<input name="SearchType" id="SearchType3" type="radio" onChange="SetSelect();Keyin()">
          					<label for="SearchType3" style="color:blue;font-size:12pt;">&nbsp;Prefix Title&nbsp;</label>
          				</td>
          				<td>
          					<span style="color:blue;cursor: pointer;font-size:12pt;" onClick="Clear();">Clear</span><br>		
          				</td>
          			</tr>
          		</table>
				<span id="msg"></span>
			</td>
			<td align="center" width="10%">
				<span align="center" style="color:blue;"><a href="index.htm"><img src="images/home.png"> Home </a>
				<br></span>Seach Tipiṭaka
			</td>
			<td width="2%"></td>
		</tr>
		<tr style="line-height: 150%">
			<td></td>
			<!--  onClick="document.getElementById('out').innerHTML= '';" -->
			<td colspan="3" id="suggest">
				<span id="out"></span>
			</td>
			<td></td>
		</tr>
	</tbody>
	</table>

	<table align="left" bgcolor="#ffffc0" border="0" cellspacing="1" cellpadding="3" width="100%">
	<tbody>
		<tr>
			<td width="1%">
			</td>
			<td align="center" width="17%" bgcolor="#bfb070">
				<input id="All" type="checkbox" name="All" onclick='choosePali("All")' /></input>
				<label for="All" onclick='choosePali("All")'>ALL</label>
			</td>
			<td width="27%" bgcolor="#dfd090">
				<input id="MAT1" type="checkbox" name="MAT1" onclick='choosePali("x1")' /></input>
				<label for="MAT1" onclick='choosePali("x1")'>1 Mūla</label>
			</td>
			<td width="27%" bgcolor="#dfd090">
				<input id="MAT2" type="checkbox" name="MAT2" onclick='choosePali("x2")' /></input>
				<label for="MAT2" onclick='choosePali("x2")'>2 Aṭṭhakathā</label>
			</td>
			<td width="27%" bgcolor="#dfd090">
				<input id="MAT3" type="checkbox" name="MAT3" onclick='choosePali("x3")' /></input>
				<label for="MAT3" onclick='choosePali("x3")'>3 Ṭīkā</label>
			</td>
			<td width="1%"></td>
		</tr>
		<tr>
			<td valign="top"></td>
			<td bgcolor="#dfd090" valign="top">
				<input id="Nikaya1" type="checkbox" name="Nikaya1" onclick='choosePali("1x")' /></input>
				<label for="Nikaya1" onclick='choosePali("1x")'>●1 Vinayapiṭaka</label>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x11">
				<input id="Nikaya11" type="checkbox" name="Nikaya11" onclick='choosePali("11")' /></input>
				<span id="Out11"></span>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x12">
				<input id="Nikaya12" type="checkbox" name="Nikaya12" onclick='choosePali("12")' /></input>
				<span id="Out12"></span>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x13">
				<input id="Nikaya13" type="checkbox" name="Nikaya13" onclick='choosePali("13")' /></input>
				<span id="Out13"></span>
			</td>
		</tr>
		<tr>
			<td valign="top"></td>
			<td bgcolor="#dfd090" valign="top">
				<input id="Nikaya2" type="checkbox" name="Nikaya2" onclick='choosePali("2x")' /></input>
				<label for="Nikaya2" onclick='choosePali("2x")'>●2 Dīghanikāya</label>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x21">
				<input id="Nikaya21" type="checkbox" name="Nikaya21" onclick='choosePali("21")' /></input>
				<span id="Out21"></span>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x22">
				<input id="Nikaya22" type="checkbox" name="Nikaya22" onclick='choosePali("22")' /></input>
				<span id="Out22"></span>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x23">
				<input id="Nikaya23" type="checkbox" name="Nikaya23" onclick='choosePali("23")' /></input>
				<span id="Out23"></span>
			</td>
		</tr>
		<tr>
			<td valign="top"></td>
			<td bgcolor="#dfd090" valign="top">
				<input id="Nikaya3" type="checkbox" name="Nikaya3" onclick='choosePali("3x")' /></input>
				<label for="Nikaya3" onclick='choosePali("3x")'>●3 Majjhimanikāya</label>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x31">
				<input id="Nikaya31" type="checkbox" name="Nikaya31" onclick='choosePali("31")' /></input>
				<span id="Out31"></span>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x32">
				<input id="Nikaya32" type="checkbox" name="Nikaya32" onclick='choosePali("32")' /></input>
				<span id="Out32"></span>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x33">
				<input id="Nikaya33" type="checkbox" name="Nikaya33" onclick='choosePali("33")' /></input>
				<span id="Out33"></span>
			</td>
		</tr>
		<tr>
			<td valign="top"></td>
			<td bgcolor="#dfd090" valign="top">
				<input id="Nikaya4" type="checkbox" name="Nikaya4" onclick='choosePali("4x")' /></input>
				<label for="Nikaya4" onclick='choosePali("4x")'>●4 Saṃyuttanikāya</label>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x41">
				<input id="Nikaya41" type="checkbox" name="Nikaya41" onclick='choosePali("41")' /></input>
				<span id="Out41"></span>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x42">
				<input id="Nikaya42" type="checkbox" name="Nikaya42" onclick='choosePali("42")' /></input>
				<span id="Out42"></span>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x43">
				<input id="Nikaya43" type="checkbox" name="Nikaya43" onclick='choosePali("43")' /></input>
				<span id="Out43"></span>
			</td>
		</tr>
		<tr>
			<td valign="top"></td>
			<td bgcolor="#dfd090" valign="top">
				<input id="Nikaya5" type="checkbox" name="Nikaya5" onclick='choosePali("5x")' /></input>
				<label for="Nikaya5" onclick='choosePali("5x")'>●5 Aṅguttaranikāya</label>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x51">
				<input id="Nikaya51" type="checkbox" name="Nikaya51" onclick='choosePali("51")' /></input>
				<span id="Out51"></span>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x52">
				<input id="Nikaya52" type="checkbox" name="Nikaya52" onclick='choosePali("52")' /></input>
				<span id="Out52"></span>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x53">
				<input id="Nikaya53" type="checkbox" name="Nikaya53" onclick='choosePali("53")' /></input>
				<span id="Out53"></span>
			</td>
		</tr>
		<tr>
			<td valign="top"></td>
			<td bgcolor="#dfd090" valign="top">
				<input id="Nikaya6" type="checkbox" name="Nikaya6" onclick='choosePali("6x")' /></input>
				<label for="Nikaya6" onclick='choosePali("6x")'>●6 Khuddakanikāya</label>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x61">
				<input id="Nikaya61" type="checkbox" name="Nikaya61" onclick='choosePali("61")' /></input>
				<span id="Out61"></span>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x62">
				<input id="Nikaya62" type="checkbox" name="Nikaya62" onclick='choosePali("62")' /></input>
				<span id="Out62"></span>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x63">
				<input id="Nikaya63" type="checkbox" name="Nikaya63" onclick='choosePali("63")' /></input>
				<span id="Out63"></span>
			</td>
		</tr>
		<tr>
			<td valign="top"></td>
			<td bgcolor="#dfd090" valign="top">
				<input id="Nikaya7" type="checkbox" name="Nikaya7" onclick='choosePali("7x")' /></input>
				<label for="Nikaya7" onclick='choosePali("7x")'>●7 Abhidhammapiṭaka</label>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x71">
				<input id="Nikaya71" type="checkbox" name="Nikaya71" onclick='choosePali("71")' /></input>
				<span id="Out71"></span>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x72">
				<input id="Nikaya72" type="checkbox" name="Nikaya72" onclick='choosePali("72")' /></input>
				<span id="Out72"></span>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x73">
				<input id="Nikaya73" type="checkbox" name="Nikaya73" onclick='choosePali("73")' /></input>
				<span id="Out73"></span>
			</td>
		</tr>
		<tr>
			<td valign="top"></td>
			<td bgcolor="#dfd090" valign="top">
				<input id="Nikaya8" type="checkbox" name="Nikaya8" onclick='choosePali("8x")' /></input>
				<label for="Nikaya8" onclick='choosePali("8x")'>●8 Añña</label>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x81">
				<input id="Nikaya81" type="checkbox" name="Nikaya81" onclick='choosePali("81")' style="visibility:hidden;" /></input>
				<span id="Out81" style="visibility:hidden;"></span>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x82">
				<input id="Nikaya82" type="checkbox" name="Nikaya82" onclick='choosePali("82")' /></input>
				<span id="Out82"></span>
			</td>
			<td bgcolor="#ffe0b0" valign="top" id="x83">
				<input id="Nikaya83" type="checkbox" name="Nikaya83" onclick='choosePali("83")' /></input>
				<span id="Out83"></span>
			</td>
		</tr>
	</tbody>
</table>

	<div id="velthuis" align="center" style="display:none;">
		<center>
		<table width="90%">
			<tr>
				<td align="left">
					<b>The Velthuis Scheme</b>
				</td>
				<td align="right">
				</td>
			</tr>
			<tr>
				<td class="small">
					<i>(taken from <a class="small" href="http://www.tipitaka.net/pali/paliload.php?page=velthuis" style="color:green">http://www.tipitaka.net/pali/paliload.php?page=velthuis</a>)</i>
				</td>
			</tr>
		</table>
		<table width="90%" border="1" bordercolor="#FF9900" cellspacing="0" cellpadding="3"onClick="Velthuis();">
			<tr>
				<td rowspan="15" valign="top" >
					<p><b>Double the vowels, Punctuate the consonants</b></p>
					<p>This scheme was originally developed in 1991 by Frans Velthuis for use with
					 his <i>devnag</i> Devanagari font, designed for the TeX typesetting system. Pali
					 and Sanskrit scholars have since adopted it as a standard technique in Internet
					 correspondence.</p>
					<p>In the Velthuis scheme, two basic rules are observed:</p>
					<p>1. Long vowels (those with a macron (bar) above them) are doubled: aa, ii, uu.</p>
					<p>2. For consonants, the diacritic mark precedes the letter it affects. Thus,
					 the retroflex (cerebral) consonants (those with a dot underneath) are: .r .t .th
					 .d .dh .n .m .s .l. The guttural nasals (m  with a dot below or n with a dot above) are
					 represented by "m and "n. The palatal nasal (n with a tilde) is ~n.</p>
					<p>The scheme is precise, although it takes a while to get used to. Here a table of the
					 affected Pali letters in both unicode form and Velthuis scheme.</p>
				</td>
				<td bgcolor="#F0F000"><b>Unicode</b></td>
				<td bgcolor="#F0F000"><b>Velthuis</b></td>
			</tr>

			<tr>
				<td bgcolor="#F0F000" colspan="2" align="center">(Long vowels)</td>
			</tr>

			<tr>
				<td bgcolor="#F0F000" align="center">ā</td>
				<td bgcolor="#F0F000" align="center">aa</td>
			</tr>
			<tr>
				<td bgcolor="#F0F000" align="center">ī</td>
				<td bgcolor="#F0F000" align="center">ii</td>
			</tr>
			<tr>
				<td bgcolor="#F0F000" align="center">ū</td>
				<td bgcolor="#F0F000" align="center">uu</td>
			</tr>
			<tr>
				<td bgcolor="#F0F000" colspan="2" align="center">(Consonants)</td>
			</tr>
			<tr>
				<td bgcolor="#F0F000" align="center">ṅ</td>
				<td bgcolor="#F0F000" align="center">"n</td>
			</tr>
			<tr>
				<td bgcolor="#F0F000" align="center">ñ</td>
				<td bgcolor="#F0F000" align="center">~n</td>
			</tr>
			<tr>
				<td bgcolor="#F0F000" align="center">ṭ</td>
				<td bgcolor="#F0F000" align="center">.t</td>
			</tr>
			<tr>
				<td bgcolor="#F0F000" align="center">ṭh</td>
				<td bgcolor="#F0F000" align="center">.th</td>
			</tr>
			<tr>
				<td bgcolor="#F0F000" align="center">ḍ</td>
				<td bgcolor="#F0F000" align="center">.d</td>
			</tr>
			<tr>
				<td bgcolor="#F0F000" align="center">ḍh</td>
				<td bgcolor="#F0F000" align="center">.dh</td>
			</tr>
			<tr>
				<td bgcolor="#F0F000" align="center">ṇ</td>
				<td bgcolor="#F0F000" align="center">.n</td>
			</tr>
			<tr>
				<td bgcolor="#F0F000" align="center">ḷ</td>
				<td bgcolor="#F0F000" align="center">.l</td>
			</tr>
			<tr>
				<td bgcolor="#F0F000" align="center">ṃ</td>
				<td bgcolor="#F0F000" align="center">.m</td>
			</tr>
		</table>
	</div>

	<a name="Velthuis"></a>

<br><br>
	<script>
		P_TNO = '';
		P_TNX = '';
	</script>

	<script src="js/z_search_pali_no.js"></script>
	<script src="js/z_tipitaka_Maps.js"></script>
	<script src="js/search_Fuzzy.js"></script>
	<script src="js/search_Exact.js"></script>
	<script src="js/search_Prefix.js"></script>
	<script src="js/search_Suffix.js"></script>
	<script src="js/search_Title_No.js"></script>

	<script>

		//<script src="dictionary/z_search_pali_words.js"></ script>
    	function Put(val) {
    		var key = document.getElementById('key').value.trim();
    		var pos = key.lastIndexOf(' ');
    		if (pos != -1) {
    			document.getElementById('key').value = key.substr(0, pos) + ' ' + val;
    		} else {
    			document.getElementById('key').value = val + ' ';
    		}
    		Start_Fuzzy();
    	}

		function replacei(str, sub, f) {
			let A = str.toLowerCase().split(sub.toLowerCase());
			let B = [];
			let x = 0;
			for (let i = 0; i < A.length; i++) {
				let n = A[i].length;
				B.push(str.substr(x, n));
				if (i < A.length-1)
					B.push(f(str.substr(x + n, sub.length)));
				x += n + sub.length;
			}
			return B.join('');
		}

		function toUniRegEx(input) {
			if(!input || input == '') return input;
			var nigahita = 'ṃ';
			var Nigahita = 'Ṃ'; 

			input = input.replace(/\-.r/g, 'ṝ').replace(/\.r/g, 'ṛ').replace(/\.R/g, 'Ṛ');
			input = input.replace(/\-.l/g, 'ḹ').replace(/\.h/g, 'ḥ');
			input = input.replace(/\"S/g, 'Ś').replace(/\"s/g, 'ś').replace(/\.S/g, 'Ṣ').replace(/\.s/g, 'ṣ');
			input = input.replace(/ee/g, 'ē').replace(/oo/g, 'ō');

			input = input.replace(/\"n/g, 'ṅ').replace(/aa/g, 'ā').replace(/ii/g, 'ī').replace(/uu/g, 'ū').replace(/\.t/g, 'ṭ').replace(/\.d/g, 'ḍ').replace(/\"nk/g, 'ṅk').replace(/\"ng/g, 'ṅg').replace(/\.n/g, 'ṇ').replace(/\.m/g, nigahita).replace(/\u1E41/g, nigahita).replace(/\~n/g, 'ñ').replace(/\.l/g, 'ḷ').replace(/AA/g, 'Ā').replace(/II/g, 'Ī').replace(/UU/g, 'Ū').replace(/\.T/g, 'Ṭ').replace(/\.D/g, 'Ḍ').replace(/\"N/g, 'Ṅ').replace(/\.N/g, 'Ṇ').replace(/\.M/g, Nigahita).replace(/\~N/g, 'Ñ').replace(/\.L/g, 'Ḷ');
			return input;
		}

		function SetSelect() {
			var dsp = 'none';
			if (document.getElementById('SearchType1').checked == true) {
				dsp = 'inline';
			}
			for (i=1; i<=3; i++) {
				for (j=1; j<=8; j++) {
					no = '' + j + '' + i;
					document.getElementById('Nikaya' + no).style.display = dsp;
					document.getElementById('Out' + no).innerHTML = '';
				}
			}
			// document.getElementById('out').innerHTML = '';
		}

		function Jump(url) {
			html = url.substring(0, 4) + '.htm';
			id = url.substring(4);
			document.write = localStorage.setItem('history_pos', '#R' + id);		// W=New Window, I=Jump ID
			window.open(html, '_blank');
		}


		pws = [];

		function Keyin() {
			var key = toUniRegEx(document.getElementById('key').value);
			document.getElementById('key').value = key;
			key = key.trim().toLowerCase();

			if (document.getElementById('SearchType1').checked == true) {
				key_ary = key.split(' ');
				key_ary_length = key_ary.length;

				var out = "";
				var key_notfound = "";
				for (key_i=0; key_i<key_ary_length; key_i++) {
					key = key_ary[key_i].trim();
					var len = key.length;
					if (1 <= len) {
						if ((pws[key.substring(0, 1)] == undefined) && ('abcdeghijklmnoprstuvyñāīūḍḷṃṅṇṭ'.indexOf(key.substring(0, 1)) != -1)) {
							var newscript = document.createElement('script');
							newscript.setAttribute('type', 'text/javascript');
							newscript.setAttribute('src', 'dictionary/zz_search_' + key.substring(0, 1) + '.js');
							var head = document.getElementsByTagName('head')[0];
							head.appendChild(newscript); 
						}	

						if ((key_i +1) ==  key_ary_length) {
							cx = 0;
							var out_tmp = "";

							for (var i in pws) {
								if (i.substring(0, len) == key) {
									cx = cx +1;
									out_tmp = out_tmp + '<a hef="javascript:void(0)" style="color:blue;" onClick="Put(\'' + i + '\');">' + i + '</a>' + " <span style='font-size:9pt;color:#800080;'>" + pws[i] + "</span>,&nbsp;&nbsp;&nbsp;";
									if (cx > 99) {
										out_tmp = out_tmp + " <span style='font-size:12pt;color:red;'>> 99...</span>";
										break;
									}
								}
							}

							if (out_tmp == "") {
								key_notfound = key_notfound + key + " ";
							} else {
								out = out + out_tmp;
							}
						} else {
							if (pws[key] == undefined) {
								key_notfound = key_notfound + key + ".... ";
							}
						}
					}
				}
				document.getElementById('out').innerHTML = out;
			} else {
				if (2 < key.length) {
					var ary = [];
					for (i=1; i<=3; i++) {
						for (j=1; j<=8; j++) {
							no = '' + j + '' + i;
							ary[no] = '';
							document.getElementById('Out' + no).innerHTML = '';
						}
					}

					var type2 = document.getElementById('SearchType2').checked;
					var lenx = key.length;

					old = 'x';
					cx = 0;
					for (i in P_TNO) {
						sutta = i.substring(0, 4)
						no = i.substring(0, 2);
						var sub = i.substr(8, lenx);
						//chk = document.getElementById('Nikaya' + no).checked;
						//if ((i.indexOf(key) != -1) && (chk == true)) {
						if (((i.indexOf(key) != -1) && type2) || ((sub == key) && !type2)) {
							
							if (old != sutta) {
								ary[no] = ary[no] + '<hr style="border: 1pt dashed gray;"><b style="color:brown;">' + sutta + " " + T_Book[sutta] + "</b><br>";
							}
							cx = cx + 1;

							name = i.substring(8);
							name = name.replace(key, '<span style="background:yellow">' + key + '</span>');

							ary[no] = ary[no] + cx + ' ' + '<a href="javascript:void(0);" onClick="Jump(\'' + sutta + P_TNO[i] + '\')" title="' + P_TNO[i] + '">' + name + '<span></a><br>';
							old = sutta;
						}
					}	

					for (i=1; i<=3; i++) {
						for (j=1; j<=8; j++) {
							no = '' + j + '' + i;
							id = 'Out' + no;
							document.getElementById(id).innerHTML = ary[no];
						}
					}
				}	
			}	
		}

		//**************************************************************************************
		

		//**************************************************************************************
		

		//**************************************************************************************
		

		//**************************************************************************************
		

		//**************************************************************************************
		function Velthuis() {
			v1 = document.getElementById("velthuis").style.display;
			if (v1 == "none") {
				document.getElementById("velthuis").style.display = "inline";
			} else {
				document.getElementById("key").focus();
				document.getElementById("velthuis").style.display = "none";

			}
		}

		function Clear() {
	        for (i in localStorage) {
	        	if (i.substring(0, 3) == 'Sr_') {
	          		document.write.innerHTML = localStorage.setItem(i, '');
	          		document.write.innerHTML = localStorage.removeItem(i);
	          	}	
	        } 

			document.write.innerHTML = localStorage.setItem("Sr_key", '');
			document.getElementById('key').value = '';
			document.getElementById('key').focus();
			for (x=1; x<=3; x++) {
				for (y=1; y<=8; y++) {
					var name1 = 'Out' + y + x;
					document.getElementById(name1).innerHTML = '';
				}
			}
		}

		function choosePali(val) {
			var chk, key, x , y;
			var v1 = val.substring(0, 1);
			var v2 = val.substring(1, 2);

			if (val == 'All') {
				chk = document.getElementById('All').checked;
				for (x=1; x<=3; x++) {
					for (y=1; y<=8; y++) {
						key = 'Nikaya' + y + x;
						document.getElementById(key).checked = chk;
					}
				}
			}
			if (v1 == 'x') {
				chk  = document.getElementById('MAT' + v2).checked;
				for (y=1; y<=8; y++) {
					key = 'Nikaya' + y + v2;
					document.getElementById(key).checked = chk;
				}
			}
			if (v2 == 'x') {
				chk  = document.getElementById('Nikaya' + v1).checked;
				for (x=1; x<=3; x++) {
					key = 'Nikaya' + v1 + x;
					document.getElementById(key).checked = chk;
				}
			}
		}

		function Show_Detail(id) {
			var html = document.getElementById(id).innerHTML;
			var pos1 = html.indexOf('<hr');
			if (pos1 == -1) {
				document.getElementById(id).innerHTML = document.getElementById(id).innerHTML + localStorage.getItem('Sr_' + id);
			} else {
				document.getElementById(id).innerHTML = document.getElementById(id).innerHTML.substring(0, pos1);
			}
		}

window.onload = function () {
			
		// new code to have all boxes checked.. search is fast so why not?
		// 
		// maybe later we can save in local storage and check based on that.	
		document.getElementById('All').checked = true;
		choosePali('All');
	}


		// add listener to go back when the escape key is pressed.
		window.addEventListener("keyup", function(e){ if(e.keyCode == 27) history.back(); }, false);
  </script>
</div>

</body>
</html>
