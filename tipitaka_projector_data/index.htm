<!DOCTYPE html>
<html>
<head>
    <title></title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="TIPITAKA PROJECTOR ICON" href="images/favico.ico"/>
    <link rel="stylesheet" type="text/css" href="js/index_style.css"/>
    <link rel="stylesheet" type="text/css" href="js/index_style2.css"/>
    <link rel="stylesheet" type="text/css" href="css/js.tree.style.min.css"/>
    <link rel="stylesheet" type="text/css" href="js/jquery-ui-1.12.1/jquery-ui.css"/>
    <link rel="stylesheet" type="text/css" href="single.page.css"/>
    <link rel="stylesheet" type="text/css" href="js/farbtastic12/farbtastic/farbtastic.css"  />
 

    <script src="js/jquery-3.5.1.js"></script>
    <script src="js/jquery-ui-1.12.1/jquery-ui.js"></script>
    <script src="js/jquery.ui.touch-punch.js"></script>

    <script src="js/jstree.js"></script>
    <script src="js/index_initialize.js"></script>
    <script src="js/preferences.single.page.js"></script>
    <script src="js/savefile.js"></script>
    <script src="js/rgbcolor.js"></script>
    <script src="js/farbtastic12/farbtastic/farbtastic.js"></script>

    <script src="js/epublib/jszip.min.js"></script>
    <script src="js/epublib/epub.min.js"></script>

    <script>
        var UseSinglePageLoading = true;
        var DEBUG = true;

        var bookData = {
            structure: {},
            flat: {}
        };



//////////////////////////////////////////////////////////////////////////
/////
////                JSTREE & INDEX DIALOG STUFF
////
////////////////////////////////////////////////////////////////////////

        $.jstree.defaults.core.themes.variant = 'large';

        const setBookInfo = (rawBookMetaData) => {
            const structuredData = JSON.parse(rawBookMetaData).books;

            for (const book of structuredData) {
                for (const set of book.sets) {
                    for (const text of set.texts) {
                        const extraInfo = {set: set.name, book: book.name};
                        bookData.flat[text.bookId] = Object.assign(extraInfo, text);
                    }
                }
            }

            const treeData = structuredData.map(sd => {
                return {
                    text: sd.name,
                    children: sd.sets.map(set => {
                        return {
                            text: set.name,
                            children: set.texts.map(text => {
                                return {
                                    text: text.title,
                                    icon: 'images/text.png',
                                    data: text
                                }
                            })
                        }
                    })
                }
            });

            $('#books-tree').jstree({core: {data: treeData}});

            $('#books-tree').on('select_node.jstree', (event, data) => {
                if (data && data.node && data.node.data) {
                    // this is actual text
                    const bookInfo = data.node.data;
                    PaliHistoryGoUrl(bookInfo.bookId + "#p1");
                } else {
                    // this is an expandable entity (e.g. a book)
                    //
                    data.instance.toggle_node(data.selected);
                }
            });
        };

        const width = () => $(window).width() - 40;
        const height = () => $(window).height() - 40;
        
// ================================================================================

    var epubRendition;
    var epubBook;
    var loadEpubBook = function loadEpubBook(fileName) {
    
        // Close previously opened book
        //
        if (epubRendition) {
            epubRendition.destroy();
        }
        
        // Load the opf
        //
        var book = epubBook = ePub(`epub/${fileName}`);

        var rendition = epubRendition = book.renderTo("book-area", {width: '100%', height: '100%', method: "continuous",  flow: "scrolled-doc", spread: "always"});
        var displayed = rendition.display();

        var PaliFontSize = localStorage.getItem("PaliFontSize");
        var PaliFontName = localStorage.getItem("font_left")
        var bg_color = localStorage.getItem("bg_color");
        var bookarea = document.getElementById("book-area");
        var epubDialog = document.getElementById("epub");

        bookarea.style.backgroundColor = bg_color;
        epubDialog.style.backgroundColor = bg_color;
        epubDialog.style.overflowX="hidden";
        bookarea.style.overflowX="hidden";

        const fontColor = `${getFontColor()} !important`;

        // EPUB Rendition Style Overrides
        //
        rendition.themes.default({
            p: {
                'line-height': '150%', 
                'font': `${PaliFontSize}pt ` + `${PaliFontName}`,
                'color': fontColor
            },
            'h1' : {'color': getFontColor()},
            'h2' : {'color': getFontColor()},
            'h3' : {'color': getFontColor()},
            body: {
            'padding-left': '20px !important',
            'padding-right': '20px !important',
            'color': getFontColor()
            }
        });


        var keyListener = function(e){
                // Left Key
                if ((e.keyCode || e.which) == 37) {
                  epubBook.package.metadata.direction === "rtl" ? epubRendition.next() : epubRendition.prev();
                }

                // Right Key
                if ((e.keyCode || e.which) == 39) {
                  epubBook.package.metadata.direction === "rtl" ? epubRendition.prev() : epubRendition.next();
                }
        };

        book.ready.then(() => {
              epubRendition.on("keyup", keyListener);
              //document.addEventListener("keyup", keyListener, false);
        });

        book.loaded.navigation.then(function(toc){
            const $select = $('#toc');
            $select.off();

            const getToc = (toc) => {
                let result = '';
                for (const t of toc) {
                    result += `\n<option data-ref="${t.href}">${t.label}</option>`;
                    if (t.subitems && t.subitems.length > 0) {
                        result += `\n<optgroup label="${t.label}">${getToc(t.subitems)}</optgroup>`;
                    }

                }
                return result;
            }
            const options = getToc(toc.toc);
            $select.html(options);

            $select.change(function(){
                    const index = this.selectedIndex;
                    const url = this.options[index].dataset.ref;
                    rendition.display(url);
                    return false;
            });

        });
    }
    
    const halfTableWidth = () => $('#main_table').outerWidth() * 0.5;

    var initDialogs = () => {
        $('#index').dialog({autoOpen: false, maxHeight: $(window).height()});
        $('#epub-selector').dialog({autoOpen: false, width: 256, height: 770, resizable: false, draggable: true});
        
        $('#epub').dialog({
                    autoOpen: false,
                    resizable: true,
                    draggable: true,

                    maxHeight: $(window).height(),
                    maxWidth: $(window).width(),
                    
                    width: Math.min(halfTableWidth(), 600),
                    height: Math.min($(window).height(), 850),

                    open: function () {
                        const dialogOptions = {
                            maxHeight: height(),
                            maxWidth: width(),
                            
                            height: $(window).height(),
                            width: halfTableWidth(),
                        };
                        console.log(dialogOptions, 'dialog options');
                        $(this).dialog('option', dialogOptions);
                        $(this).dialog('option', {
                            position: { my: "right top", at: "right top", of: $('body')}
                        });
                        if (epubRendition) {
                            epubRendition.resize($(this).outerWidth() - 88, $(this).outerHeight() - 36 - 20);
                            epubRendition.display();
                        }
                    },
                    resizeStop: function(event, ui) {
                        epubRendition.resize($(this).outerWidth() - 88, $(this).outerHeight() - 36 - 20);
                        epubRendition.display();
                    }
                });
    // ================================================================================

    //////////////////////////////////////////////////////////////////////////
    /////
    ////                SEARCH DIALOG STUFF
    ////
    ////////////////////////////////////////////////////////////////////////



                $('#search').dialog({
                    autoOpen: false,
                    resizable: true,
                    draggable: true,

                    maxHeight: $(window).height(),
                    maxWidth: $(window).width(),
                    
                    width: Math.min($(window).width(), 1144),

                    open: function () {
                        $(this).dialog('option', {
                            maxHeight: $(window).height(),
                            maxWidth: $(window).width(),
                        });
                    }
                });


        /////////////////////////////////////////////
        // code for prefs dialog to work
        //  prefs dialog stuf
        /////////////////////////////
        $(function () {
            const width = () => $(window).width() - 40;
            const height = () => $(window).height() - 40;
     


            $("#prefsDialog").dialog({
                autoOpen: false,
                resizable: true,
                draggable: true,

                maxHeight: width(),
                maxWidth: height(),
                
                width: Math.min(900, width()),

                open: function () {
                    $(this).dialog('option', {
                        maxWidth: width(),
                        maxHeight: height()
                    });
                }
            });
            $("#prefsbutton").click(function () {
                $("#prefsDialog").dialog("open");
            });
        });

    };
 




//////////////////////////////////////////////////
//  
//    Book Index DLG
//
/////////////////////////////////////////////////////////

        var showIndex = function showIndex() {
            $('#index').dialog('open');
        };

        var showDialog = function showDialog(dialogId) {
            $(dialogId).dialog('open');
        };
        
        var showEpubDemo = function showEpubDemo() {
            showDialog('#epub-selector');
        }
        
        $(document).ready(() => { 
            initDialogs();

            $('body').on('click', '#epub-selector .epub-books li', function() {
                const fileName = this.dataset.fileName;
                showDialog('#epub');
                $('#epub-selector').dialog('close');
                loadEpubBook(fileName);
            });

            $.ajax({
                url: 'books.json',
                dataType: "text",
                type: "GET",
                mimeType: 'text/json; charset=utf-8',
                contentType: 'text/json; charset=UTF-8',
                success: setBookInfo
            });
        });
    </script>
</head>

<body style="background-color: black; margin-top:0.0pt;margin-right:0in;margin-bottom:0in;margin-left:0in;margin-bottom:0pt;">

<div id="main_div">

    <header class="panel-header" id="panel-header">
        <img src="images/dhammacakka.svg" height="22" width="22"/>
        <span>Tipiṭaka  Pāḷi Projector</span>
    </header>

    <div class="first-nav">
        <!-- HOME -->
        <div class="notselected grey-button" onClick="showIndex()" title="Home">
            <i class="material-icons">library_books</i>
        </div>

        <!-- SEARCH -->
        <div class="notselected grey-button" onClick="showDialog('#search')" title="Seach">
            <i class="material-icons">search</i>
        </div>

        <!-- PREFERENCES -->
        <div class="notselected grey-button" id="prefsbutton" title="Preferences">
            <i class="material-icons">settings</i>
        </div>

        <span class="sep"></span>

        <div class="notselected grey-button letter" id="Pali1" title="Mūla" onClick="MATurlGo('1')">
            M
        </div>

        <div class="notselected grey-button letter" id="Pali2" title="Aṭṭhakathā" onClick="MATurlGo('2')">
            A
        </div>

        <div class="notselected grey-button letter" id="Pali3" title="Ṭīkā" onClick="MATurlGo('3')">
            T
        </div>
        
        <div class="notselected grey-button letter free" title="EPUB Demo" onClick="showEpubDemo()">
            E
        </div>

    </div>

    <div class="dict">

        <span id="message" style="font-size:10pt;"
              title="Id=Id-No. Para=Paragraph No. M=Myanmar PageNo. P=PTS PageNo."></span>

        <div id="TmpDictionary" style="display:inline;margin-left:10px;">
        </div>
    </div>

    <ul class="tabs">
        <li class="selected" id="page1" onclick="onTabClick(this)" data-helper="dict">
            Dict.
        </li>

        <li class="notselected" id="page2" onclick="onTabClick(this);" data-helper="decl">
            Decl.
        </li>

        <li class="notselected" id="page3" onclick="onTabClick(this);">
            Par.
        </li>

        <li class="notselected" id="page4" onclick="onTabClick(this);">
            Nav.
        </li>

        <li class="notselected" id="page5" onclick="onTabClick(this);">
            Misc.
        </li>
    </ul>

    <script>
        const onTabClick = (tab) => {
            // hide all helpers
            //  For consistent UI, the temp dictionary listings and location will be shown all the time
            // following line hides these
            $('.helper').hide();

            // show a helper associated with the tab
            //
            if (tab.dataset.helper) {
                $(`.helper.${tab.dataset.helper}`).show();
            }

            change_tab(tab.id);

            if (tab.id === 'page3') {
                ParagraphAnalysis();

            } else if (tab.id === 'page1') {
                DictionaryGo();

            }
        };
    </script>

    <div class="tab-content" id="tab-content">
        <div class="helpers">
            <div class="helper dict">
                <div class="search-area">
                    <i onClick="paliGoBack()" class="material-icons">arrow_back</i>&nbsp;&nbsp;
                    <span>&nbsp;Pāḷi:&nbsp;</span>
                    <input type="textbox" class="generous-input" style="max-width:85%;width:85pt;display:inline;"
                           id="DictionaryKey" name="DictionaryKey">

                    <!-- just display:none a wrapped "GO" button for now so it remains in the DOM and won't break JS.. -->
                    <div style="display: none">
                        <input type="button" value="Go" onClick="DictionaryKeyGo();" id="GoDictionary">
                    </div>

                    <span>&nbsp;Algo:&nbsp;&nbsp;</span>
                    <select id="algorithm-selector">
                        <option value="auto">Auto</option>
                        <option value="dpr">DPR</option>
                        <option value="tpp">TPP</option>
                        <option value="none">None</option>
                    </select>
                    <script>
                        // defaults to auto
                        //
                        const currentAlgo = localStorage.getItem('tpp-breakup-algo') || 'auto';

                        const $algoSelect = $('#algorithm-selector');
                        $algoSelect.find('option').removeAttr('selected');
                        $algoSelect.find('option[value="' + currentAlgo + '"]').attr('selected', 'selected');
                        $algoSelect.on('change', function () {
                            localStorage.setItem('tpp-breakup-algo', this.value);
                            // refresh the dictionary lookup
                            //
                            DictionaryGo();
                        });
                    </script>

                </div>
                <div id="lookup-results">

                </div>
                <script>
                    const $lookupResults = $('#lookup-results');
                    $lookupResults.on('click', '.lookup-result', function () {
                        $('#DictionaryKey').val(this.dataset.word);
                        DictionaryGo();
                    });
                    const performLookup = (val) => {
                        const lookupResults = WordListLookup(val);
                        $lookupResults.empty();
                        let resultHTML = '';
                        for (const result of lookupResults) {
                            resultHTML += '<div class="lookup-result" data-word="' + result + '">' + result + '</div>';
                        }
                        $lookupResults.html(resultHTML);
                    };

                    let debounceTimeout;
                    $('#DictionaryKey').on('input', function () {
                        clearTimeout(debounceTimeout);
                        const value = this.value;
                        debounceTimeout = setTimeout(() => {
                            performLookup(value);
                        }, 300);
                    });
                    $('.helper.dict').show();
                </script>
            </div>


            <div class="helper decl">
                <input type="textbox" style="max-width:85%;width:85pt;display:none;" id="DeclensionKey"
                       name="DeclensionKey" onKeyup="DeclensionSearch();">
                <input type="button" value="Go" onClick="DictionaryKeyGo();" id="GoDeclension" style="display:none;">
            </div>
        </div>

        <div id="main_content" style="padding-top:5px; width:100%;">
            <div id="page1_desc" class="pages" style="max-height: 80%;height: 80%;overflow-y: scroll;">
                Sukhi Hontu!
            </div>

            <div id="page2_desc" class="pages2"
                 style="display:none;padding-top: 1px;overflow-x:auto;overflow-y: auto;width:100%;">

                <span id="DeclensionTips2" class="DeclensionSelect"></span>

                <div id='DeclensionResult' class="DeclensionResult"></div>
                <br>

                <img src="images/s_info.png" onMouseover="document.getElementById('info').style.display='inline';"
                     onMouseout="document.getElementById('info').style.display='none';">
                <span id="info" style="display:none;font-size:11pt;">
            Velthuis Pali Letters,&nbsp;&nbsp;Wildcard Search, Ex:*sa, *sa*
          </span>
                <br><br>
            </div>

            <div id="page3_desc" class="pages" style="display:none;">
                <div id='ParagraphDictionary'>
                </div>
            </div>
            <input type="hidden" id="ParagraphWords" value="">

            <div id="page4_desc" class="pages2" style="display:none;text-align:left;">
                <div class="page4" style="line-height: 250%; text-align: center">
                    <select name="Toc" id="Toc" onchange="goToc();">
                    </select>
                    <span id="page4break1"></span>

                    <input name="Reference" id="Pgnum" value="0" type="radio" checked>
                    <label for="Pgnum">Page...</label>
                    <input name="Reference" id="Prnum" value="1" type="radio">
                    <label for="Prnum">Paragraph...</label>
                    <span id="page4break2"></span>

                    <input name="Reference" id="PTS" value="2" type="radio">
                    <label for="PTS">PTS No...</label>
                    <input type="Textbox" name="PageNo" id="PageNo" value=""
                           style="font-size:11pt;width:100%;max-width:40pt;" onBlur="goUrl()">
                    <br>

                    <div style="line-height: 110%;">
                        <div onClick="document.getElementById('QuickJumpTipsShow').style.display='inline';"
                             style="color:blue;">
                            <img src="images/s_info.png">Tips
                        </div>
                        <div id="QuickJumpTipsShow" onClick="this.style.display='none'"
                             style="color:#440000;font-size:11pt;display:none;">[sn1 99]= Jump to sn1 Paragraph 99,<br>[sn1
                            m99]= Jump to sn1 Myanmar Page 99,<br>[sn1 p99] or [sn1 pts99]= Jump to sn1 PTS Page 99.<br>
                        </div>
                    </div>
                    Quick Jump
                    <input type="Textbox" name="QuickJump" id="QuickJump" value=""
                           style="font-size:11pt;width:100%;max-width:60pt;" onKeyup="QuickJumpTips()">
                    <input type="button" id="QuickJumpBtn" value="Quick Jump" onclick="QuickJump()"></button>
                    <span id="QuickJumpTips" style="color:#440000;"></span>
                </div>
                <span id="page4break3"></span>

                <div class="page4">
                    <img src='images/b_browse.png'>History
                    <span id='palihistory' style="font-size:10pt;color:blue;"></span>&nbsp;&nbsp;
                </div>
            </div>

            <div id="page5_desc" class="pages2" style="display:none;">
                <div class="page5">
                    <img src='images/b_browse.png'>Dictionary History
                    <span id='dicthistory' style="font-size:11pt;color:blue;"></span>&nbsp;&nbsp;
                </div>
                <span id="page5break1"></span>

                <div class="page5">
                    <img src='images/b_ftext.png' width="24">Copy Text
                    &nbsp;
                    <span id="copystart" onClick="CopyExport(1)" style="font-size:10pt;color:blue">
              <img src="images/change.png" width="22">&nbsp;Start Selection
              <input type="hidden" id="copy1" value="">
            </span>
                    <span id="copyunformat" onClick="CopyExport(2)" style="display:none;font-size:10pt;color:blue">
              <img src="images/b_sbrowse.png" width="22">&nbsp;UnFormat TXT
              <input type="hidden" id="copy2" value="">
              <input type="hidden" id="copystatus" value="stop">
            </span>
                    <span id="copyformat" onClick="CopyExport(3)" style="display:none;font-size:10pt;color:blue">
              <img src="images/b_report.png" width="22">&nbsp;Format HTML
              <input type="hidden" id="copy3" value="">
            </span>
                    <span id="copycancel" onClick="CopyExport(0)" style="display:none;font-size:10pt;color:blue">
              <img src="images/s_cancel.png" width="22">&nbsp;Cancel
            </span>
                    <br>
                    <textarea id='CopyText'
                              style='width:95%;max-width:95%;max-height:95%; height:70%;overflow:hidden;resize:none;'></textarea>
                </div>
                <span id="page5break2"></span>

                <div class="page5">
                    <table style="border-collapse:collapse;padding:5px;width:100%;height:100%; border:0px;">
                        <tr>
                            <td valign="top" width="50%">
                                <input type="hidden" id="mynote1" value="">
                                <input type="hidden" id="mynoteids" value="">
                                <input type="hidden" id="mynotetags" value="">
                                <input type="hidden" id="mynoteolds" value="">

                                <span id="mynote5" onClick="MyNoteExport(5)"
                                      style="font-size:12pt;color:blue;margin-bottom:10px">
                    <img src="images/add_point_on.png" width="22">Edit 5 Par.<br><br>
                  </span>
                                <span id="mynotesave" onClick="MyNoteExport(1)"
                                      style="display:none;font-size:12pt;color:blue">
                    <img src="images/save.png" width="22">Save<br><br>
                  </span>

                                <span id="mynote10" onClick="MyNoteExport(10)"
                                      style="font-size:12pt;color:blue;margin-bottom:10px">
                    <img src="images/add_point_on.png" width="22">Edit 10 Par.<br><br>
                  </span>
                                <span id="mynotecancel" onClick="MyNoteExport(0)"
                                      style="display:none;font-size:12pt;color:blue">
                    <img src="images/s_cancel.png" width="22">&nbsp;Cancel
                  </span>

                                <span id="mynote20" onClick="MyNoteExport(20)" style="font-size:12pt;color:blue">
                    <img src="images/add_point_on.png" width="22">Edit 20 Par.
                  </span>

                            </td>
                            <td valign="top" width="50%">
                  <span onClick="AnkiAdd()" style="font-size:12pt;color:blue">
                    <img src="images/Anki-icon.svg.png" width="22">Add to Anki
                  </span>
                                <br><br>

                                <span onClick="AnkiCopy()" style="font-size:12pt;color:blue">
                    <img src="images/s_okay.png" width="22">Copy
                  </span>
                                <br><br>

                                <span onClick="AnkiClear()" style="font-size:12pt;color:blue">
                    <img src="images/b_drop.png" width="22">Clear
                  </span>
                            </td>
                        </tr>
                    </table>

                </div>
            </div>
        </div>
    </div>

    <div style="display:inline;margin-left:10px; margin-top: 50px; width:100%;">
        <div id="iPad" style="display:inline">
            <select id="iPadDirection" onchange="iPadDirection()">
                <option value="NW">Top-Left</option>
                <option value="NE">Top-Right</option>
                <option value="SE">Bottom-Right</option>
                <option value="SW">Bottom-Left</option>
            </select>
            <span id="iPadW">W</span>
            <select id="iPadWidth" onchange="iPadWidth()">
                <option value=""></option>
            </select>
            <span id="iPadH">H</span>
            <select id="iPadHeight" onchange="iPadHeight()">
                <option value=""></option>
            </select>
        </div>

        <style>
            #PC * {
                user-select: none;
                -moz-user-select: none;
            }
        </style>

        <div id="PC" style="display:inline">
            <div id="divDragIcon" style="
        z-index:3;
        overflow: hidden;
        position: absolute;
        bottom: 5px;
        width: 24px;
        height:24px;">
                <img src="images/drag.png">
            </div>
            <div id="ResizeDrag"><img src="images/resize.png" width="35"></div>
        </div>
    </div>

    <div id="ResizeRight"></div>
    <div id="ResizeBottom"></div>

    <div id="ResizeLeft"></div>
    <div id="ResizeTop"></div>

    <script>
        var doAdjustTabContent = function () {
            const tc = document.getElementById('tab-content');
            const md = document.getElementById('main_div');

            const mainRect = md.getBoundingClientRect();
            const contentRect = tc.getBoundingClientRect();

            if (mainRect.width === 0 || mainRect.height === 0 || contentRect.height === 0 || contentRect.width === 0) {
                setTimeout(function () {
                    adjustTabContent();
                }, 300);
            } else {
                const availableHeight = mainRect.height - contentRect.top + mainRect.top - 42;
                tc.style.height = `${availableHeight}px`;
            }
        };
        var adjustTabContent = function adjustTabContent(immediately) {
            if (immediately) {
                doAdjustTabContent();
            } else {
                setTimeout(function () {
                    doAdjustTabContent()
                }, 0);
            }
        };
    </script>
    <script>
        var interfaceFlags = {
            movePanel: false,
            resizeLeft: false,
            resizeTop: false
        };
        var moveInfo = {
            movePanel: {x: 0, y: 0},
            resizeLeft: {x: 0, y: 0},
            resizeTop: {x: 0, y: 0},
        };
        const panelHeader = document.getElementById('panel-header');
        const leftResizeArea = document.getElementById('ResizeLeft');
        const topResizeArea = document.getElementById('ResizeTop');

        const getMovement = function (which, e) {
            if (e.movementX !== undefined) {
                return {
                    x: e.movementX,
                    y: e.movementY
                }
            }

            // This all is handling touches rather than mouse input:
            //

            const cx = e.touches && e.touches[0].clientX || 0;
            const cy = e.touches && e.touches[0].clientY || 0;

            const mx = cx - moveInfo[which].x;
            const my = cy - moveInfo[which].y;

            moveInfo[which].x = cx;
            moveInfo[which].y = cy;

            return {x: mx, y: my};
        };

        var onPanelMove = function (e) {
            if (interfaceFlags.movePanel === false) {
                return;
            }

            const mainDivBox = panelHeader.parentElement.getBoundingClientRect();
            const box = panelHeader.parentElement.getBoundingClientRect();

            const movement = getMovement('movePanel', e);

            const nextX = Math.min(window.innerWidth - mainDivBox.width, Math.max(0, movement.x + box.x));
            const nextY = Math.min(window.innerHeight - mainDivBox.height, Math.max(0, movement.y + box.y));

            panelHeader.parentElement.style.left = `${nextX}px`;
            panelHeader.parentElement.style.top = `${nextY}px`;
        };

        var onResizeLeft = function onResizeLeft(e) {
            if (interfaceFlags.resizeLeft === false) {
                return;
            }
            e.stopPropagation();
            e.preventDefault();
            const mainDivBox = panelHeader.parentElement.getBoundingClientRect();
            // -20 because box-sizing is not border-box and has padding etc
            const currentWidth = mainDivBox.width - 20;
            const currentLeft = mainDivBox.left;

            const movement = getMovement('resizeLeft', e);

            const nextLeft = Math.max(0, currentLeft + movement.x);
            const delta = nextLeft - currentLeft;
            const nextWidth = currentWidth - delta;

            panelHeader.parentElement.style.left = `${nextLeft}px`;
            panelHeader.parentElement.style.width = `${nextWidth}px`;
        };

        var onResizeTop = function onResizeLeft(e) {
            if (interfaceFlags.resizeTop === false) {
                return;
            }
            e.stopPropagation();
            e.preventDefault();
            const mainDivBox = panelHeader.parentElement.getBoundingClientRect();
            // -36.667 because box-sizing is not border-box and has padding etc
            const currentHeight = mainDivBox.height - 36.667;
            const currentTop = mainDivBox.top;

            const movement = getMovement('resizeTop', e);
            const nextTop = Math.max(0, currentTop + movement.y);
            const delta = nextTop - currentTop;
            const nextHeight = currentHeight - delta;

            panelHeader.parentElement.style.top = `${nextTop}px`;
            panelHeader.parentElement.style.height = `${nextHeight}px`;

            adjustTabContent(true);
        };

        const onMove = function (e) {
            if (interfaceFlags.movePanel) {
                onPanelMove(e);
            } else if (interfaceFlags.resizeLeft) {
                onResizeLeft(e);
            } else if (interfaceFlags.resizeTop) {
                onResizeTop(e);
            }
        };

        document.addEventListener('mousemove', onMove);
        document.addEventListener('touchmove', onMove);

        const down = function (which, e) {
            if (localStorage.getItem('contentposition') === '0') {
                interfaceFlags[which] = true;
                moveInfo[which] = {
                    x: e.clientX || e.touches[0].clientX,
                    y: e.clientY || e.touches[0].clientY
                };
                e.stopPropagation();
                e.preventDefault();
            }
        };

        // panel
        panelHeader.addEventListener('mousedown', function (e) {
            down('movePanel', e)
        });
        panelHeader.addEventListener('touchstart', function (e) {
            down('movePanel', e)
        });

        leftResizeArea.addEventListener('mousedown', function (e) {
            down('resizeLeft', e)
        });
        leftResizeArea.addEventListener('touchstart', function (e) {
            down('resizeLeft', e)
        });

        topResizeArea.addEventListener('mousedown', function (e) {
            down('resizeTop', e)
        });
        topResizeArea.addEventListener('touchstart', function (e) {
            down('resizeTop', e)
        });

        const onUp = function () {
            if (interfaceFlags.movePanel === true) {
                interfaceFlags.movePanel = false;
            } else if (interfaceFlags.resizeLeft === true) {
                interfaceFlags.resizeLeft = false;
            } else if (interfaceFlags.resizeTop === true) {
                interfaceFlags.resizeTop = false;
            }
            document.body.removeEventListener('mousemove', onPanelMove);
            document.body.removeEventListener('touchmove', onPanelMove);

            document.body.removeEventListener('mousemove', onResizeLeft);
            document.body.removeEventListener('touchmove', onResizeLeft);

            document.body.removeEventListener('mousemove', topResizeArea);
            document.body.removeEventListener('touchmove', topResizeArea);
        };
        document.addEventListener('mouseup', onUp);
        document.addEventListener('touchend', onUp);

    </script>
</div>

<div id="main_td2" class="main_td2">
    <div id="loader" style="z-index: auto;"></div>
    <div id="welcome">
        <div class="welcome-content">
            <span class="center"> <!-- Inline parent element -->
                <b>Tipitaka Pāḷi Projector</b> 
            <br>
                <img src="images/asoka.png" alt="asoka" > 
            </span>
            <a href="https://github.com/bksubhuti/Tipitaka-Pali-Projector"><u><h1>https://github.com/bksubhuti/Tipitaka-Pali-Projector</h1></u></a>
            <a href="https://www.youtube.com/channel/UCMKjBJT7vMjyWt8RU4lpiDg"><h1>Visit and subscribe to the Tipitaka Pāḷi Projector Youtube Channel <u>here.</u></h1></a>
            
            
        </div>
    </div>
    <table id="main_table" bgcolor="#010101" width=100% border=0 align="left" cellspacing=3 cellpadding=7
           style="padding-left: 15px;">


    </table>
    <script type="text/javascript">
        var loadBook = function loadBook(bookId, onBookLoadingDone) {
            $('#welcome').remove();
            var bookInfo = bookData.flat[bookId];
            var start = new Date();
            if (DEBUG) {
                console.log(start);
                console.log('Loading book:', bookInfo);
            }
            if (!bookInfo) {
                return;
            }

            // Set the document/window title
            //
            document.title = bookInfo.title;
            html_no=bookId; // this is an important global variable for nav history, etc
            SetMATButtons();

            // Empty the table showing the book contents in case
            // it was showing another book previously
            //
            var $table = $('#main_table');
            $table.empty();

            // Create empty rows to be filled with the book content later on
            //
            var rows = '';
            for (var i = 1; i <= bookInfo.rows; i++) {
                var row = "<tr><td class='r1' id='p" + i + "'></td><td class='m1' id='m" + i + "'></td></tr>";
                rows += row;
            }
            $table.html(rows);

            // These are the book .js files
            //
            var bookMetaFile = 'pali/' + bookId + '.js';
            var bookParagraphsFile = 'pali/' + bookId + 'a.js';

            if (DEBUG) {
                console.log('Will load book contents:', [bookMetaFile, bookParagraphsFile].map(e => `'${e}'`).join(', '));
            }

            start = new Date();
            loadInSequence([bookMetaFile, bookParagraphsFile], function onDone() {
                if (DEBUG) {
                    console.log('Loaded book contents in ' + (new Date().getTime() - start.getTime()) + ' ms.');
                }

                // Set the table styling before filling the content of the book 
                // to avoid repaint
                //
                setTableStyling();

                // Load the book text content, paragraph data etc
                //
                displayBook();

                EnglishModeLoadEpub(bookInfo.bookId);

                // Set Theme Colors
                //
                setThemeStyling();
                
                if (onBookLoadingDone) {
                    onBookLoadingDone();
                }
            });
        }
    </script>
</div>

<div id="Sr_Div">
    <img src="images/b_drop.png" width="20" height="20" onClick="Sr_Go('0')">
    <br>
    <img src="images/b_prevpage.png" width="25" height="40" onClick="Sr_Go('1')">
    &nbsp;
    <img src="images/b_nextpage.png" width="25" height="40" onClick="Sr_Go('2')">
    <br>
    <span id="Sr_Now">0</span>
    &nbsp;/&nbsp;
    <span id="Sr_Next">999</span>
</div>

<popupfix></popupfix>

<script type="text/javascript">
    var scriptsToLoad = [
        'jquery_stlookup.js',
        'function0_main.js',
        'function0_main_content.js',
        'function1_dictionary.js',
        'function2_declension.js',
        'function3_paragraph.js',
        'function4_TOC.js',
        'function5_copy.js',
        'function5_history.js',
        'function5_mynote.js',
        'function5_anki.js',
        'z_tipitaka_Maps.js',
        'z_search_navigator.js'
    ];

    // This is a global jQuery getString override.
    // It's used in other external .js files loaded after the main content, for example function0_main.js
    // It's very important to have it so that this works in Firefox browsers
    $.getScript = function (fileToLoad) {
        $.ajax({
            url: fileToLoad,
            dataType: "script",
            type: "GET",
            mimeType: 'text/plain; charset=utf-8',
            contentType: 'text/javascript; charset=UTF-8',
            success: function (data) {
                jQuery.globalEval(data);
            }
        });
    };

    var addScriptToBody = function addScriptToBody(path) {
        var scriptTag = document.createElement('script');
        scriptTag.setAttribute('type', 'text/javascript');
        scriptTag.setAttribute('src', path);
        document.body.appendChild(scriptTag);
    };

    var addScriptToHead = function addScriptToHead(path) {
        var scriptTag = document.createElement('script');
        scriptTag.setAttribute('type', 'text/javascript');
        scriptTag.setAttribute('src', path);
        document.head.appendChild(scriptTag);
    };

    var scriptsLength = scriptsToLoad.length;
    var head = document.getElementsByTagName('head')[0];
    for (var i = 0; i < scriptsLength; i++) {
        addScriptToBody('js/' + scriptsToLoad[i]);
    }
</script>

<popupfix></popupfix>
<!---End of add dictionary function--->

<!---Search Dialog stuff ----------->
<!---Search Dialog stuff ----------->
<!---Search Dialog stuff ----------->
<!---Search Dialog stuff ----------->
<!---Search Dialog stuff ----------->
<!---Search Dialog stuff ----------->


<div id="index" title="Books Index" class="app-dialog">
    <div id="books-tree"></div>
</div>

<div id="epub-selector" title="EPUB Books" class="app-dialog">
    <ul class="epub-books">
        <li data-file-name="bod-1-parajika.epub">Vinaya Pārājika</li>
        <li data-file-name="bod-2-pacittiya.epub">Vinaya Pācittiya</li>
        <li data-file-name="bod-3-mahavagga.epub">Vinaya Mahāvagga</li>
        <li data-file-name="bod-4-culavagga.epub">Vinaya Cūḷavagga</li>
        <li data-file-name="bod-5-parivara.epub">Vinaya Parivāra</li>
        <li data-file-name="dn_en_sujato.epub">Dīgha Nikāya</li>
        <li data-file-name="mn_en_sujato.epub">Majjhima Nikāya</li>
        <li data-file-name="sn_en_sujato.epub">Saṃyutta Nikāya</li>
        <li data-file-name="an_en_sujato.epub">Aṅguttara Nikāya</li>
        <li data-file-name="thag_en_sujato.epub">Theragāthā</li>
        <li data-file-name="thig_en_sujato.epub">Therīgāthā</li>
        <li data-file-name="Buddhist-Legends-1.epub">DhammapadaA-1</li>
        <li data-file-name="Buddhist-Legends-2.epub">DhammapadaA-2</li>
        <li data-file-name="JatakaVol.1,The-E.B.Cowell.epub">JātakaA-1</li>
        <li data-file-name="JatakaVol.2,The-E.B.Cowell.epub">JātakaA-2</li>
        <li data-file-name="JatakaVol.3,The-E.B.Cowell.epub">JātakaA-3</li>
        <li data-file-name="JatakaVol.4,The-E.B.Cowell.epub">JātakaA-4</li>
        <li data-file-name="JatakaVol.5,The-E.B.Cowell.epub">JātakaA-5</li>
        <li data-file-name="JatakaVol.6,The-E.B.Cowell.epub">JātakaA-6</li>
    </ul>
</div>

<div id="epub" title="English Reader" class="app-dialog">
    <select id="toc"></select>
    <span class="center">
    <i onClick="epubRendition.prev()" class="material-icons">arrow_back</i>&nbsp;&nbsp;
    <i onClick="epubRendition.next()" class="material-icons">arrow_forward</i>&nbsp;&nbsp;
</span>
    <div id="book-area"></div>
    <div id="viewer" class="scrolled"></div>
</div>

<div id="search" title="Search" class="app-dialog">
    <table align="center" bgcolor="#ffffc0" border="0" width="100%" cellpadding="0" cellspacing="0">
        <tbody>
        <tr>
            <td width="2%"></td>
            <td align="right" valign="center" width="10%">
                <img src="images/asoka.png" draggable="false">
            </td>
            <td align="center" width="76%">
                <span style='line-height:140%;color:brown;font-size:15pt;'><b>Tipiṭaka Pāḷi Projector</b></span> -
                20200330 (TG)

                <hr style="border: 1pt dashed gray; width:50%;">
                Entry <a href="#Velthuis" onClick="Velthuis()" title="Show Velthuis">
                <span style="color:blue;">Velthuis Pali</span></a> word&nbsp;
                <input type="textbox" name="key" id="key" style="font-size:12pt;width:100%;max-width:280px;"
                       onkeyup="Keyin()" value="">
                <input type="hidden" id="id1">
                <input type="hidden" id="id2">
                
                <label class="switch">
                    <input id="ShowOnTop" type="checkbox" onClick="ShowOnTopClick(checked)" >
                    <span class="slider round"></span>
                  </label>
                  <label for="ShowOnTop" style="color:blue;font-size:12pt;">&nbsp;Results On Top&nbsp;</label>

                <table border="0" width="80%">
                    <tr>
                        <td width="20%" align="right">
                            Search in :&nbsp;
                        </td>
                        <td width="70%">
                            <input name="SearchType" id="SearchType1" type="radio" onChange="SetSelect();Keyin()"
                                   checked>
                            <label for="SearchType1" style="color:blue;font-size:12pt;">&nbsp;Tipiṭaka&nbsp;</label>


                            <input type="submit" onClick="Start_Fuzzy()" name="Submit" value="Fuzzy">&nbsp;&nbsp;
                            <input type="submit" onClick="Start_Exact()" name="Submit" value="Exact">&nbsp;&nbsp;
                            <input type="submit" onClick="Start_Prefix()" name="Submit" value="Prefix">&nbsp;&nbsp;
                            <input type="submit" onClick="Start_Suffix()" name="Submit" value="Suffix"><br>
                        </td>
                        <td width="10%"></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <input name="SearchType" id="SearchType2" type="radio" onChange="SetSelect();Keyin()">
                            <label for="SearchType2" style="color:blue;font-size:12pt;">&nbsp;Fuzzy Title&nbsp;</label>
                            <input name="SearchType" id="SearchType3" type="radio" onChange="SetSelect();Keyin()">
                            <label for="SearchType3" style="color:blue;font-size:12pt;">&nbsp;Prefix Title&nbsp;</label>
                        </td>
                        <td>
                            <span style="color:blue;cursor: pointer;font-size:12pt;" onClick="Clear();">Clear</span><br>
                        </td>

                    </tr>
                </table>
                <span id="msg"></span>
            </td>
            <td align="center" width="10%">
				<br></span>Seach Tipiṭaka
            </td>
            <td width="2%"></td>
        </tr>
        <tr style="line-height: 150%">
            <td></td>
            <!--  onClick="document.getElementById('out').innerHTML= '';" -->
            <td colspan="3" id="suggest">
                <span id="out"></span>
            </td>
        </tr>
        <tr style="line-height: 150%">
            <td></td>
        <td colspan="3" id="SearchResultTD">
            <span id="SearchResult" style="display: none";></span>
        </td>
    </tr>

        </tbody>
    </table>

    <table align="left" bgcolor="#ffffc0" border="0" cellspacing="1" cellpadding="3" width="100%">
        <tbody>
        <tr>
            <td width="1%">
            </td>
            <td align="center" width="23%" bgcolor="#bfb070">
                <input id="All" type="checkbox" name="All" onclick='choosePali("All")'/></input>
                <label for="All" onclick='choosePali("All")'>ALL</label>
            </td>
            <td width="23%" bgcolor="#dfd090">
                <input id="MAT1" type="checkbox" name="MAT1" onclick='choosePali("x1")'/></input>
                <label for="MAT1" onclick='choosePali("x1")'>1 Mūla</label>
            </td>
            <td width="23%" bgcolor="#dfd090">
                <input id="MAT2" type="checkbox" name="MAT2" onclick='choosePali("x2")'/></input>
                <label for="MAT2" onclick='choosePali("x2")'>2 Aṭṭhakathā</label>
            </td>
            <td width="23%" bgcolor="#dfd090">
                <input id="MAT3" type="checkbox" name="MAT3" onclick='choosePali("x3")'/></input>
                <label for="MAT3" onclick='choosePali("x3")'>3 Ṭīkā</label>
            </td>
            <td width="1%"></td>
        </tr>
        <tr>
            <td valign="top"></td>
            <td bgcolor="#dfd090" valign="top">
                <input id="Nikaya1" type="checkbox" name="Nikaya1" onclick='choosePali("1x")'/></input>
                <label for="Nikaya1" onclick='choosePali("1x")'>●1 Vinayapiṭaka</label>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x11">
                <input id="Nikaya11" type="checkbox" name="Nikaya11" onclick='choosePali("11")'/></input>
                <span id="Out11"></span>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x12">
                <input id="Nikaya12" type="checkbox" name="Nikaya12" onclick='choosePali("12")'/></input>
                <span id="Out12"></span>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x13">
                <input id="Nikaya13" type="checkbox" name="Nikaya13" onclick='choosePali("13")'/></input>
                <span id="Out13"></span>
            </td>
        </tr>
        <tr>
            <td valign="top"></td>
            <td bgcolor="#dfd090" valign="top">
                <input id="Nikaya2" type="checkbox" name="Nikaya2" onclick='choosePali("2x")'/></input>
                <label for="Nikaya2" onclick='choosePali("2x")'>●2 Dīghanikāya</label>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x21">
                <input id="Nikaya21" type="checkbox" name="Nikaya21" onclick='choosePali("21")'/></input>
                <span id="Out21"></span>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x22">
                <input id="Nikaya22" type="checkbox" name="Nikaya22" onclick='choosePali("22")'/></input>
                <span id="Out22"></span>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x23">
                <input id="Nikaya23" type="checkbox" name="Nikaya23" onclick='choosePali("23")'/></input>
                <span id="Out23"></span>
            </td>
        </tr>
        <tr>
            <td valign="top"></td>
            <td bgcolor="#dfd090" valign="top">
                <input id="Nikaya3" type="checkbox" name="Nikaya3" onclick='choosePali("3x")'/></input>
                <label for="Nikaya3" onclick='choosePali("3x")'>●3 Majjhimanikāya</label>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x31">
                <input id="Nikaya31" type="checkbox" name="Nikaya31" onclick='choosePali("31")'/></input>
                <span id="Out31"></span>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x32">
                <input id="Nikaya32" type="checkbox" name="Nikaya32" onclick='choosePali("32")'/></input>
                <span id="Out32"></span>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x33">
                <input id="Nikaya33" type="checkbox" name="Nikaya33" onclick='choosePali("33")'/></input>
                <span id="Out33"></span>
            </td>
        </tr>
        <tr>
            <td valign="top"></td>
            <td bgcolor="#dfd090" valign="top">
                <input id="Nikaya4" type="checkbox" name="Nikaya4" onclick='choosePali("4x")'/></input>
                <label for="Nikaya4" onclick='choosePali("4x")'>●4 Saṃyuttanikāya</label>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x41">
                <input id="Nikaya41" type="checkbox" name="Nikaya41" onclick='choosePali("41")'/></input>
                <span id="Out41"></span>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x42">
                <input id="Nikaya42" type="checkbox" name="Nikaya42" onclick='choosePali("42")'/></input>
                <span id="Out42"></span>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x43">
                <input id="Nikaya43" type="checkbox" name="Nikaya43" onclick='choosePali("43")'/></input>
                <span id="Out43"></span>
            </td>
        </tr>
        <tr>
            <td valign="top"></td>
            <td bgcolor="#dfd090" valign="top">
                <input id="Nikaya5" type="checkbox" name="Nikaya5" onclick='choosePali("5x")'/></input>
                <label for="Nikaya5" onclick='choosePali("5x")'>●5 Aṅguttaranikāya</label>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x51">
                <input id="Nikaya51" type="checkbox" name="Nikaya51" onclick='choosePali("51")'/></input>
                <span id="Out51"></span>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x52">
                <input id="Nikaya52" type="checkbox" name="Nikaya52" onclick='choosePali("52")'/></input>
                <span id="Out52"></span>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x53">
                <input id="Nikaya53" type="checkbox" name="Nikaya53" onclick='choosePali("53")'/></input>
                <span id="Out53"></span>
            </td>
        </tr>
        <tr>
            <td valign="top"></td>
            <td bgcolor="#dfd090" valign="top">
                <input id="Nikaya6" type="checkbox" name="Nikaya6" onclick='choosePali("6x")'/></input>
                <label for="Nikaya6" onclick='choosePali("6x")'>●6 Khuddakanikāya</label>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x61">
                <input id="Nikaya61" type="checkbox" name="Nikaya61" onclick='choosePali("61")'/></input>
                <span id="Out61"></span>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x62">
                <input id="Nikaya62" type="checkbox" name="Nikaya62" onclick='choosePali("62")'/></input>
                <span id="Out62"></span>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x63">
                <input id="Nikaya63" type="checkbox" name="Nikaya63" onclick='choosePali("63")'/></input>
                <span id="Out63"></span>
            </td>
        </tr>
        <tr>
            <td valign="top"></td>
            <td bgcolor="#dfd090" valign="top">
                <input id="Nikaya7" type="checkbox" name="Nikaya7" onclick='choosePali("7x")'/></input>
                <label for="Nikaya7" onclick='choosePali("7x")'>●7 Abhidhammapiṭaka</label>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x71">
                <input id="Nikaya71" type="checkbox" name="Nikaya71" onclick='choosePali("71")'/></input>
                <span id="Out71"></span>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x72">
                <input id="Nikaya72" type="checkbox" name="Nikaya72" onclick='choosePali("72")'/></input>
                <span id="Out72"></span>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x73">
                <input id="Nikaya73" type="checkbox" name="Nikaya73" onclick='choosePali("73")'/></input>
                <span id="Out73"></span>
            </td>
        </tr>
        <tr>
            <td valign="top"></td>
            <td bgcolor="#dfd090" valign="top">
                <input id="Nikaya8" type="checkbox" name="Nikaya8" onclick='choosePali("8x")'/></input>
                <label for="Nikaya8" onclick='choosePali("8x")'>●8 Añña</label>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x81">
                <input id="Nikaya81" type="checkbox" name="Nikaya81" onclick='choosePali("81")'
                       style="visibility:hidden;"/></input>
                <span id="Out81" style="visibility:hidden;"></span>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x82">
                <input id="Nikaya82" type="checkbox" name="Nikaya82" onclick='choosePali("82")'/></input>
                <span id="Out82"></span>
            </td>
            <td bgcolor="#ffe0b0" valign="top" id="x83">
                <input id="Nikaya83" type="checkbox" name="Nikaya83" onclick='choosePali("83")'/></input>
                <span id="Out83"></span>
            </td>
        </tr>
        </tbody>
    </table>

    <div id="velthuis" align="center" style="display:none;">
        <center>
            <table width="90%">
                <tr>
                    <td align="left">
                        <b>The Velthuis Scheme</b>
                    </td>
                    <td align="right">
                    </td>
                </tr>
                <tr>
                    <td class="small">
                        <i>(taken from <a class="small" href="http://www.tipitaka.net/pali/paliload.php?page=velthuis"
                                          style="color:green">http://www.tipitaka.net/pali/paliload.php?page=velthuis</a>)</i>
                    </td>
                </tr>
            </table>
            <table width="90%" border="1" bordercolor="#FF9900" cellspacing="0" cellpadding="3" onClick="Velthuis();">
                <tr>
                    <td rowspan="15" valign="top">
                        <p><b>Double the vowels, Punctuate the consonants</b></p>
                        <p>This scheme was originally developed in 1991 by Frans Velthuis for use with
                            his <i>devnag</i> Devanagari font, designed for the TeX typesetting system. Pali
                            and Sanskrit scholars have since adopted it as a standard technique in Internet
                            correspondence.</p>
                        <p>In the Velthuis scheme, two basic rules are observed:</p>
                        <p>1. Long vowels (those with a macron (bar) above them) are doubled: aa, ii, uu.</p>
                        <p>2. For consonants, the diacritic mark precedes the letter it affects. Thus,
                            the retroflex (cerebral) consonants (those with a dot underneath) are: .r .t .th
                            .d .dh .n .m .s .l. The guttural nasals (m with a dot below or n with a dot above) are
                            represented by "m and "n. The palatal nasal (n with a tilde) is ~n.</p>
                        <p>The scheme is precise, although it takes a while to get used to. Here a table of the
                            affected Pali letters in both unicode form and Velthuis scheme.</p>
                    </td>
                    <td bgcolor="#F0F000"><b>Unicode</b></td>
                    <td bgcolor="#F0F000"><b>Velthuis</b></td>
                </tr>

                <tr>
                    <td bgcolor="#F0F000" colspan="2" align="center">(Long vowels)</td>
                </tr>

                <tr>
                    <td bgcolor="#F0F000" align="center">ā</td>
                    <td bgcolor="#F0F000" align="center">aa</td>
                </tr>
                <tr>
                    <td bgcolor="#F0F000" align="center">ī</td>
                    <td bgcolor="#F0F000" align="center">ii</td>
                </tr>
                <tr>
                    <td bgcolor="#F0F000" align="center">ū</td>
                    <td bgcolor="#F0F000" align="center">uu</td>
                </tr>
                <tr>
                    <td bgcolor="#F0F000" colspan="2" align="center">(Consonants)</td>
                </tr>
                <tr>
                    <td bgcolor="#F0F000" align="center">ṅ</td>
                    <td bgcolor="#F0F000" align="center">"n</td>
                </tr>
                <tr>
                    <td bgcolor="#F0F000" align="center">ñ</td>
                    <td bgcolor="#F0F000" align="center">~n</td>
                </tr>
                <tr>
                    <td bgcolor="#F0F000" align="center">ṭ</td>
                    <td bgcolor="#F0F000" align="center">.t</td>
                </tr>
                <tr>
                    <td bgcolor="#F0F000" align="center">ṭh</td>
                    <td bgcolor="#F0F000" align="center">.th</td>
                </tr>
                <tr>
                    <td bgcolor="#F0F000" align="center">ḍ</td>
                    <td bgcolor="#F0F000" align="center">.d</td>
                </tr>
                <tr>
                    <td bgcolor="#F0F000" align="center">ḍh</td>
                    <td bgcolor="#F0F000" align="center">.dh</td>
                </tr>
                <tr>
                    <td bgcolor="#F0F000" align="center">ṇ</td>
                    <td bgcolor="#F0F000" align="center">.n</td>
                </tr>
                <tr>
                    <td bgcolor="#F0F000" align="center">ḷ</td>
                    <td bgcolor="#F0F000" align="center">.l</td>
                </tr>
                <tr>
                    <td bgcolor="#F0F000" align="center">ṃ</td>
                    <td bgcolor="#F0F000" align="center">.m</td>
                </tr>
            </table>
    </div>

    <a name="Velthuis"></a>
</div>

<!-- HTML -->
<div id="prefsDialog"
     class="app-dialog"
     title="Preferences"
     width="auto">

    <table border="0" width="100%">
        <tr>
            <td width="100%" align="left" valign="top">
                <div style="width:100%">
                    <!-- <h2 style="text-align: center;">Preferences</h2> -->

                    <div class="tab">
                        <button class="tablinks" onclick="PrefTab(event, 'General')" id="defaultOpen">Left Right View
                        </button>
                        <button class="tablinks" onclick="PrefTab(event, 'Dictionaries')">Dictionaries</button>
                        <button class="tablinks" onclick="PrefTab(event, 'Panel')">Panel</button>
                        <button class="tablinks" onclick="PrefTab(event, 'SaveSettings')">Save-Settings</button>
                        <button class="tablinks" onclick="PrefTab(event, 'About')">About</button>
                    </div>

                    <div id="General" class="tabcontent" style="display:inline;">
                        <div style="margin-top:1%;line-height: 150%;padding:8px;background-color: #ccc; border: 2px solid #acacac;border-radius:8px;-moz-border-radius:8px;-webkit-border-radius:8px;-o-border-radius:8px;">
                            <table border="0" width="100%" cellpadding="0" cellpadding="0">
                                <tr>
                                    <td width="40%" valign="top" align="right">
                                        <strong>Left View</strong>
                                        <div style="margin-top:1%;line-height: 150%;padding:8px;background-color: #acacac; border: 2px solid #acacac;border-radius:8px;-moz-border-radius:8px;-webkit-border-radius:8px;-o-border-radius:8px;">
                                            <table border="0" width="100%" cellpadding="0" cellpadding="0">
                                                <tr>
                                                    <td width="50%" valign="top" align="center">
                                                        <strong style="color:#880000;">Width</strong>
                                                        <br>
                                                        <span id="width_left"></span>
                                                        <br><br>
                                                    </td>
                                                    <td width="50%" valign="top" align="right">
                                                        <strong style="color:#880000;">Left Text</strong>
                                                        <br>
                                                        <select name="view_left" id="view_left"
                                                                onChange='ChooseSelect("view_left")'>
                                                            <option value="Roman">Roman</option>
                                                            <option value="Myanmar">Myanmar</option>
                                                            <option value="Sinhala">Sinhala</option>
                                                            <option value="Thai">Thai</option>
                                                            <option value="Devanagari">Devanagari</option>
                                                        </select>
                                                        <br><br>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td valign="top" align="right" colspan="2">
                                                        <strong style="color:#880000;">Font Family</strong>
                                                        <br>
                                                        <select name="font_left" id="font_left"
                                                                onchange="ChooseSelect('font_left')">
                                                            <option value="Calibri Light">Calibri Light</option>
                                                            <option value="DejaVuSansCondensed">DejaVuSansCondensed
                                                            </option>
                                                            <option value="Myanmar Text">Myanmar Text</option>
                                                            <option value="Palatino Linotype">Palatino Linotype</option>
                                                            <option value="Pyidaungsu">Pyidaungsu</option>
                                                            <option value="Tahoma">Tahoma</option>
                                                            <option value="Times New Roman">Times New Roman</option>
                                                            <option value="Verdana">Verdana</option>
                                                        </select>
                                                        <br><br>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td></td>
                                                    <td valign="top" align="right">
                                                        <strong style="color:#880000;">Font Line Scale</strong>
                                                        <br>
                                                        <select name="size_left" id="size_left"
                                                                onchange="ChooseSelect('size_left')">
                                                            <option value="1.0"> x 1.0</option>
                                                            <option value="1.25"> x 1.25</option>
                                                            <option value="1.5"> x 1.5</option>
                                                            <option value="1.75"> x 1.75</option>
                                                            <option value="2"> x 2.0</option>
                                                            <option value="2.25"> x 2.25</option>
                                                            <option value="2.5"> x 2.5</option>
                                                            <option value="2.75"> x 2.75</option>
                                                            <option value="3.0"> x 3.0</option>
                                                        </select>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </td>
                                    <td width="20%" valign="top" align="center">
                                        <br>
                                        <div style="margin-top:1%;line-height: 150%;padding:8px;background-color: #acacac; border: 2px solid #acacac;border-radius:8px;-moz-border-radius:8px;-webkit-border-radius:8px;-o-border-radius:8px;">
                                            <strong style="color:#880000;">Background Color</strong>
                                            <br>
                                            <select name="bg_color" id="bg_color" onchange="ChooseSelect('bg_color');">
                                                <option value="#f3ddb6" style="background-color:#f3ddb6;color:#000000;">
                                                    Classic Reader
                                                </option>
                                                <option value="#fff8dc" style="background-color:#fff8dc;color:#000000;">
                                                    CornSilk
                                                </option>
                                                <option value="#1f3763" style="background-color:#1f3763;color:#fffffe;">
                                                    Blue sky
                                                </option>
                                                <option value="#000001" style="background-color:#000001;color:#ffffff;">
                                                    Night 1
                                                </option>
                                                <option value="#121212" style="background-color:#121212;color:#b0b0b0;">
                                                    Night 2
                                                </option>
                                                <option value="#010101" style="background-color:#010101;color:#937811;">
                                                    Night 3
                                                </option>
                                                <option value="#1e1e1e" style="background-color:#1e1e1e;color:#628754;">
                                                    Night 4
                                                </option>
                                                <option value="#090c11" style="background-color:#090c11;color:#2d3d4a;">
                                                    Night 5
                                                </option>
                                                <option value="#3c3c3c" style="background-color:#3c3c3c;color:#cecece;">
                                                    Dawn 1
                                                </option>
                                                <option value="#5a5a5a" style="background-color:#5a5a5a;color:#cacaca;">
                                                    Dawn 2
                                                </option>
                                                <option value="#d7d4cd" style="background-color:#d7d4cd;color:#626262;">
                                                    Dawn 3
                                                </option>
                                                <option value="#e0e0e0" style="background-color:#e0e0e0;color:#202020;">
                                                    Day 1
                                                </option>
                                                <option value="#f0f0f0" style="background-color:#f0f0f0;color:#008000;">
                                                    Day 2
                                                </option>
                                                <option value="#fefefe" style="background-color:#fefefe;color:#000000;">
                                                    Day 3
                                                </option>
                                                <option value="#d8cbab" style="background-color:#d8cbab;color:#000001;">
                                                    Evening 1
                                                </option>
                                                <option value="#e2bdb4" style="background-color:#e2bdb4;color:#010101;">
                                                    Evening 2
                                                </option>
                                            </select>
                                            <input type="checkbox" type=onoffswitch-checkbox id="Themes"
                                                   onclick='ChooseCheckbox("Themes")'>
                                            <label for="Themes">Themes</label>
                                            <br>
                                            <div style="margin-top:1%;line-height: 150%;padding:8px;background-color: #acacac; border: 2px solid #acacac;border-radius:8px;-moz-border-radius:8px;-webkit-border-radius:8px;-o-border-radius:8px;">
                                                <label for="PaliFontSize">Font Size</label>
                                                <select name="PaliFontSize" id="PaliFontSize"
                                                        onchange="ChooseSelect('PaliFontSize');">
                                                    <option value="10"> 10</option>
                                                    <option value="11"> 11</option>
                                                    <option value="12"> 12</option>
                                                    <option value="13"> 13</option>
                                                    <option value="14"> 14</option>
                                                    <option value="15"> 15</option>
                                                    <option value="16"> 16</option>
                                                    <option value="17"> 17</option>
                                                    <option value="18"> 18</option>
                                                    <option value="19"> 19</option>
                                                    <option value="20"> 20</option>
                                                    <option value="21"> 21</option>
                                                    <option value="22"> 22</option>
                                                    <option value="24"> 23</option>
                                                    <option value="25"> 24</option>
                                                    <option value="28"> 28</option>
                                                </select>

                                            </div>
                                            <br>
                                        </div>
                                    </td>

                                    <td width="40%" valign="top" align="left">
                                        <strong>Right View</strong>
                                        <div style="margin-top:1%;line-height: 150%;padding:8px;background-color: #acacac; border: 2px solid #acacac;border-radius:8px;-moz-border-radius:8px;-webkit-border-radius:8px;-o-border-radius:8px;">
                                            <table border="0" width="100%" cellpadding="0" cellpadding="0">
                                                <tr>
                                                    <td width="50%" valign="top">
                                                        <strong style="color:#880000;">Right Text</strong>
                                                        <br>
                                                        <select name="view_right" id="view_right"
                                                                onChange='ChooseSelect("view_right")'>
                                                            <option value="Space">None</option>
                                                            <option value="Roman">Roman</option>
                                                            <option value="Myanmar">Myanmar</option>
                                                            <option value="Sinhala">Sinhala</option>
                                                            <option value="Thai">Thai</option>
                                                            <option value="Devanagari">Devanagari</option>
                                                            <option value="MyNote">My Note</option>
                                                            <option value="Suttacentral">English Mode</option>
                                                        </select>
                                                        <br><br>
                                                    </td>
                                                    <td width="50%" valign="top" align="center">
                                                        <strong style="color:#880000;">Width</strong>
                                                        <br>
                                                        <span id="width_right"></span>
                                                        <br><br>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td valign="top">
                                                        <strong style="color:#880000;">Font Family</strong>
                                                        <br>
                                                        <select name="font_right" id="font_right"
                                                                onchange="ChooseSelect('font_right')">
                                                            <option value="Calibri Light">Calibri Light</option>
                                                            <option value="DejaVuSansCondensed">DejaVuSansCondensed
                                                            </option>
                                                            <option value="Myanmar Text">Myanmar Text</option>
                                                            <option value="Palatino Linotype">Palatino Linotype</option>
                                                            <option value="Pyidaungsu">Pyidaungsu</option>
                                                            <option value="Tahoma">Tahoma</option>
                                                            <option value="Times New Roman">Times New Roman</option>
                                                            <option value="Verdana">Verdana</option>
                                                        </select>
                                                        <br><br>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td valign="top">
                                                        <strong style="color:#880000;">Font Line Scale</strong>
                                                        <br>
                                                        <select name="size_right" id="size_right"
                                                                onchange="ChooseSelect('size_right')">
                                                            <option value="1.0"> x 1.0</option>
                                                            <option value="1.25"> x 1.25</option>
                                                            <option value="1.5"> x 1.5</option>
                                                            <option value="1.75"> x 1.75</option>
                                                            <option value="2"> x 2.0</option>
                                                            <option value="2.25"> x 2.25</option>
                                                            <option value="2.5"> x 2.5</option>
                                                            <option value="2.75"> x 2.75</option>
                                                            <option value="3.0"> x 3.0</option>
                                                        </select>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3" algin="center">
                                        <div style="text-align: center; margin-top:1%;line-height: 150%;padding:8px;background-color: #acacac; border: 2px solid #acacac;border-radius:8px;-moz-border-radius:8px;-webkit-border-radius:8px;-o-border-radius:8px;">
                                            <strong style="color:#880000;">Left - Right Frame's Width Ratio</strong>
                                            <input type="range" min=2 max=98 step=2 name="divwidth" id="divwidth"
                                                   onChange="ChooseRange('divwidth')"
                                                   style="background:#880000;color:red;width:100%;">
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div style="margin-top:1%;line-height: 150%;padding:8px;background-color: #acacac; border: 2px solid #acacac;border-radius:8px;-moz-border-radius:8px;-webkit-border-radius:8px;-o-border-radius:8px;">
                                            <strong style="color:#880000;">Dispaly Note</strong>
                                            <br>
                                            <input name="palinote" id="Pali_note1" type="radio"
                                                   onclick='ChooseRadio("Pali_note1")'>
                                            <label for="Pali_note1">Inline Display</label>
                                            <input name="palinote" id="Pali_note2" type="radio"
                                                   onclick='ChooseRadio("Pali_note2")'>
                                            <label for="Pali_note2">No Display (Default)</label>
                                            <br>
                                            <strong style="color:#880000;">Show Page Numbers</strong>
                                            <br>

                                            <input name="Show_Numbers" id="Show_Numbers1" type="radio"
                                                   onclick='ChooseRadio("Show_Numbers1")'>
                                            <label for="Show_Numbers1">Show Numbers</label>
                                            <input name="Show_Numbers" id="Hide_Numbers2" type="radio"
                                                   onclick='ChooseRadio("Hide_Numbers2")'>
                                            <label for="Hide_Numbers2">No Display</label>
                                            <br>


                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div id="Dictionaries" class="tabcontent"
                         style="margin-top:1%;line-height: 150%;padding:8px;background-color: #ccc; border: 2px solid #acacac;border-radius:8px;-moz-border-radius:8px;-webkit-border-radius:8px;-o-border-radius:8px;">
                        <table border="0" width="100%" cellspacing="0" cellpadding="0">
                            <form method="post" name="form1" action="" style="text-align:center;">
                                <tr>
                                    <td valign="top" width="46%" align="left">
                                        <strong style="color:#880000;">Disabled Pali Dictionaries</strong>
                                        <span id="DisableCount" style="font-size:10pt;color:gray;"></span>
                                        <select style="width:100%;font-size:12pt;line-height:175%;border-radius:8px;-moz-border-radius:8px;-webkit-border-radius:8px;-o-border-radius:8px;"
                                                multiple name="DictionaryDisable" id="DictionaryDisable" size="10"
                                                ondblclick="DictionaryMoveOption(document.form1.DictionaryDisable, document.form1.DictionaryEnable)"
                                                onClick="toGetAbbr('0');">
                                        </select>
                                    </td>
                                    <td valign="top" width="8%" align="center">
                                        <br>
                                        <input type="button" value="Up" style="width:60pt;"
                                               onclick="DictionaryChangePos(DictionaryEnable,-1)"/>
                                        <br><br>
                                        <input type="button" value="Down" style="width:60pt;"
                                               onclick="DictionaryChangePos(DictionaryEnable,1)"/>
                                        <br><br>

                                        <input type="button" value=">>" style="width:60pt;"
                                               onclick="DictionaryMoveOption(document.form1.DictionaryDisable, document.form1.DictionaryEnable)"/>
                                        <br><br>
                                        <input type="button" value="<<" style="width:60pt;"
                                               onclick="DictionaryMoveOption(document.form1.DictionaryEnable, document.form1.DictionaryDisable)"/>
                                    </td>
                                    <td valign="top" width="46%" align="left">

                                        <strong style="color:#880000;">Enabled Pali Dictionaries</strong>
                                        <span id="EnableCount" style="font-size:10pt;color:gray;"></span>
                                        <select style="width:100%;font-size:12pt;line-height:175%;border-radius:8px;-moz-border-radius:8px;-webkit-border-radius:8px;-o-border-radius:8px;"
                                                multiple name="DictionaryEnable" id="DictionaryEnable" size="10"
                                                ondblclick="DictionaryMoveOption(document.form1.DictionaryEnable, document.form1.DictionaryDisable)"
                                                onClick="toGetAbbr('1')">
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <br>
                                        <strong style="color:#880000;">Abbreviated of Dictionary</strong>
                                        <input type="textbox" id="Abbreviated"
                                               style="max-width:100%;width:120pt;font-size:12pt;"
                                               onBlur="toSaveAbbr();">
                                        <input type="hidden" id="AbbreviatedDictionary" value="">
                                        <span>1-8 Chars&nbsp;</span><br>
                                        <span id="AbbreviatedMessage"></span>
                                    </td>
                                </tr>
                            </form>
                        </table>
                        <br>

                        <strong style="color:#880000;">English Dictionary</strong>
                        <br>
                        <input name="hee1" id="hee1" type="checkbox" onclick='ChooseCheckbox("hee1")'/></input>
                        <label for="hee1">WN: [148,730 entries - 23.2 MB] Word-Net Eng-Eng dictionary</label>
                        <br>

                        <label style="color:red;">Speech Repeat=</label>
                        <select name="speech_repeat" id="speech_repeat" onChange="ChooseSelect('speech_repeat');">
                            <option value="0">Off</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                        </select>
                        ,&nbsp;&nbsp;
                        <label id="showspeed" style="color:red;">Speed=</label>
                        <input type="range" min=0.5 max=1.5 step=0.1 name="speech_speed" id="speech_speed"
                               onChange="ChooseRange('speech_speed')" style="background:gray;">
                    </div>
                </div>

                <div id="Panel" class="tabcontent" style="display:inline;">
                    <div style="margin-top:1%;line-height: 150%;padding:8px;background-color: #ccc; border: 2px solid #acacac;border-radius:8px;-moz-border-radius:8px;-webkit-border-radius:8px;-o-border-radius:8px;">
                        <table border="0" width="100%">
                            <tr>
                                <td width="50%">
                                    <strong style="color:#880000;">Panel Position</strong>
                                    <br>
                                    <input name="contentposition" id="positionfixed" value="1" type="radio"
                                           onclick='ChooseRadio("positionfixed")'>
                                    <label for="positionfixed" onclick='ChooseRadio("positionfixed")'>Left Fixed</label>
                                    <input name="contentposition" id="positionfloat" value="0" type="radio"
                                           onclick='ChooseRadio("positionfloat")'>
                                    <label for="positionfloat" onclick='ChooseRadio("positionfloat")'>Moveable
                                        (Default)</label>
                                    <br><br>
                                </td>
                                <td width="50%">
                                    <div style="visibility:hidden">
                                        <strong style="color:#880000;">Panel Mode</strong>
                                        <br>
                                        <input name="contentmode" id="modeipad" value="iPad" type="radio"
                                               onclick='ChooseRadio("modeipad")'>
                                        <label for="modeipad" onclick='ChooseRadio("modeipad")'>iPad</label>
                                        <input name="contentmode" id="modepc" value="PC" type="radio"
                                               onclick='ChooseRadio("modepc")'>
                                        <label for="modepc" onclick='ChooseRadio("modepc")'>PC Mode (Default)</label>
                                        <br><br>
                                    </div>
                                </td>
                            </tr>

                            <tr>
                                <td width="50%" valign="top">
                                    <strong style="color:#880000;">Panel Display</strong>
                                    <br>
                                    <input name="contentdisplay" id="displayalways" value="1" type="radio"
                                           onclick='ChooseRadio("displayalways")'>
                                    <label for="displayalways" onclick='ChooseRadio("displayalways")'>Always</label>
                                    <input name="contentdisplay" id="displayclick" value="0" type="radio"
                                           onclick='ChooseRadio("displayclick")'>
                                    <label for="displayclick" onclick='ChooseRadio("displayclick")'>On Click
                                        (Default)</label>
                                    <br><br>
                                </td>
                                <td width="50%" valign="top">
                                    <strong style="color:#880000;">Panel Position & Size</strong>
                                    <br>
                                    Top:&nbsp;<span id="main_top"></span>&nbsp;&nbsp;
                                    Left:&nbsp;<span id="main_left"></span><br>
                                    Width:&nbsp;<span id="main_width"></span>&nbsp;&nbsp;
                                    Height:&nbsp;<span id="main_height"></span>&nbsp;&nbsp;
                                    <br><br>
                                </td>
                            </tr>
                            <tr>
                                <td width="50%" valign="top">
                                    <strong style="color:#880000;">Font Family</strong>
                                    <br>
                                    <select name="contentfontname" id="contentfontname"
                                            onchange="ChooseSelect('contentfontname')">
                                        <option value="Calibri Light">Calibri Light</option>
                                        <option value="DejaVuSansCondensed">DejaVuSansCondensed</option>
                                        <option value="Myanmar Text">Myanmar Text</option>
                                        <option value="Palatino Linotype">Palatino Linotype</option>
                                        <option value="Pyidaungsu">Pyidaungsu</option>
                                        <option value="Tahoma">Tahoma</option>
                                        <option value="Times New Roman">Times New Roman</option>
                                        <option value="Verdana">Verdana</option>
                                    </select>
                                    <br><br>
                                </td>
                                <td width="50%" valign="top">
                                    <strong style="color:#880000;">Font Size</strong>
                                    <br>
                                    <input type="range" min=10 max=24 step=0.5 value=12 name="contentfontsize"
                                           id="contentfontsize" onChange="ChooseRange('contentfontsize')"
                                           style="background:gray;">
                                    <br><br>
                                </td>
                            </tr>

                            <tr>
                                <td valign="top">
                                    <strong style="color:#880000;">Select Background Color:</strong>
                                    <br>
                                    <form action="" style="width: 400px;">
                                    <div class="form-item"><label for="color2">Color:</label><input type="text"id="panel_bg_color" name="panel_bg_color" value="#f0f0f0" /></div><div id="picker2"></div>
                                    </form>

                                </td>
                                <td valign="top">
                                    <strong style="color:#880000;">Select Font Color:</strong>
                                    <br>
                                    <form action="" style="width: 400px;">
                                    <div class="form-item"><label for="color">:</label><input type="text"id="panel_font_color" name="panel_font_color" value="#123456" /></div><div id="picker"></div>
                                    </form>

                                    
                                    <br>
                                    <br>
                                </td>
                            </tr>
                            <tr>
                                <td width="50%" valign="top">
                                    <strong style="color:#880000;">Line Height</strong>
                                    <br>
                                    <select name="contentlineheight" id="contentlineheight"
                                            onchange="ChooseSelect('contentlineheight')">
                                        <option value="150">150%</option>
                                        <option value="160">160%</option>
                                        <option value="170">170%</option>
                                        <option value="180">180%</option>
                                        <option value="190">190%</option>
                                        <option value="200">200%</option>
                                        <option value="210">210%</option>
                                        <option value="220">220%</option>
                                        <option value="230">230%</option>
                                        <option value="240">240%</option>
                                        <option value="250">250%</option>
                                        <option value="260">260%</option>
                                        <option value="270">270%</option>
                                        <option value="280">280%</option>
                                        <option value="290">290%</option>
                                        <option value="300">300%</option>
                                    </select>
                                </td>
                                <td width="50%" valign="middle" align="center">
                                    <table border="0" width="100%" id="colortable">
                                        <tr>
                                            <td width="100%" id="contentbackground" style="background-color: RGB(207, 255, 128);" align="center" valign="middle">
                                                <label id="showfontnamesize" style="font-family:DejaVuSansCondensed;font-size:12pt">DejaVuSansCondensed 12pt</label><br>
                                                <span id="showbackground" style="font-family:DejaVuSansCondensed;font-size:12pt">BackGround = RGB(207, 255, 128)</span><br>
                                                <span id="showfontcolor" style="font-family:DejaVuSansCondensed;font-size:12pt">FontColor = RGB(0, 0, 0)</span><br>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div id="SaveSettings" class="tabcontent" style="display:inline;">
                    <div style="margin-top:1%;line-height: 150%;padding:8px;background-color: #ccc; border: 2px solid #acacac;border-radius:8px;-moz-border-radius:8px;-webkit-border-radius:8px;-o-border-radius:8px;">
                        <br>
                        <button id="btnRestore" onclick="RestorePreferences()"><img src="images/restorePref.png"
                                                                                    width="50" height="50"
                                                                                    border="0"><span
                                style="font-size:20px;">Restore Prefs</span></button>
                        <br><br>
                        <br>

                        <table border="0" width="100%" cellpadding="0" cellspacing="0" id="TablePreference"
                               style="line-height: 150%;">
                            <tr>
                                <td width="50%" valign="top" style="line-height: 150%;">
                                    <button id="btnSave" onclick="SavePreferences()"><img src="images/savePref.png"
                                                                                          width="50" height="50"
                                                                                          border="0"><span
                                            style="font-size:20px;">  Save Prefs</button>
                                    <br>
                                    <br>
                                    <button id="btnReset" onclick="ResetPreferences()"><img src="images/reset2.png"
                                                                                            width="50" height="50"
                                                                                            border="0"><span
                                            style="font-size:20px;">  Reset All</button>
                                    <br>
                                    <br>

                                    Step 1 :<br>
                                    &nbsp;&nbsp;Save "preference.txt"
                                    <br>
                                    Step 2 :<br>
                                    &nbsp;&nbsp;Copy this text file into<br>&nbsp;&nbsp;\tipitaka_projector_data\
                                    <br><br>
                                </td>
                                <td width="50%" valign="top">
                                    <textarea name="preferences" id="preferences"
                                              style="border:none;display:inline;font-size:9.0pt;line-height:120%;width:90%;max-width:90%x;height:100pt;background-color:#ffff88;"></textarea>
                                </td>
                            </tr>
                        </table>
                        <strong style="color:#880000;">Testing</strong>
                        <br>
                        <table border="0" width="100%" cellpadding="0" cellspacing="0" id="TablePreference">
                            <tr>
                                <td width="50%" valign="top">
                             <span style="color:blue;" onClick="window.location='analysis.htm'">  
                                <img src="images/b_empty.png">
                                Analysis
                             </span><br><br>

                                    <span style="color:blue;" onClick="window.location='analysis2.htm'">
                                <img src="images/b_empty.png">
                                Analysis 2.0
                             </span><br><br>

                                    <span style="color:blue;" onClick="window.location='analysis21.htm'">
                                <img src="images/b_empty.png">
                                Analysis 2.1
                             </span><br><br>

                                </td>
                                <td width="50%" valign="top">
                             <span style="color:blue;" onClick="window.location='export.htm'">  
                                <img src="images/save.png">
                                Export My Note
                             </span><br><br>

                                    <span style="color:blue;" onClick="window.location='notfound.htm'">
                                <img src="images/pause.png">
                                Not Found In Dictionary
                             </span><br><br>
                            </tr>
                        </table>
                    </div>
                </div>
                <div id="About" class="tabcontent" style="display:inline;">
                    <div style="margin-top:1%;line-height: 150%;padding:8px;background-color: #ccc; border: 2px solid #acacac;border-radius:8px;-moz-border-radius:8px;-webkit-border-radius:8px;-o-border-radius:8px;">
                        <img src="images/asoka.png">
                        <br>
                        Your Current Version is:
                        <div id="currentversion"></div>
                        <br>
                        <br>
                        Check Repository for Latest Version:
                        <button type="button" id="btnGetVersion" onclick="getVersion()">Check Repo</button>
                        <br>
                        <div id="versioninfo"></div>
                    </div>
                </div>

            </td>

        </tr>

    </table>
    <br>

</div>

<script>
    P_TNO = '';
    P_TNX = '';
</script>

<script src="js/z_search_pali_no.js"></script>
<script src="js/z_tipitaka_Maps.js"></script>
<script src="js/searchdlg.js"></script>
<script src="js/search_Title_No.js"></script>

<script>

/////////////////////////////////////////
///////////
////////          GENERAL SEARCH CODE  (to be moved to js soon)
///////
///////////////////////////////////////////////

    $( window ).on( 'hashchange', function( e ) {
        const hash = location.hash;
        if (!hash) {
            return;
        }
        if (hash.indexOf('#/book/' === 0)) {
            const parsedBookInfo = hash.match(/#\/book\/(\d+)\/(\d+)/i);
            if (parsedBookInfo && parsedBookInfo.length > 0) {
            
                // This "html_no" variable is used in many scripts, here it's reset
                // so that the Sr_Go function in z_search_navigator.js works
                //
                html_no = parsedBookInfo[1];

                const bookId = parseInt(html_no);

                // Get data relevant to the search and the "Sr" widget
                //
                Sr_key = localStorage.getItem("Sr_key");
                if (Sr_key) {
                    Sr_ary = Sr_key.split(' ');
                }
                Sr_id = localStorage.getItem('Sr_id'+ bookId);

                // Load the book content
                //
                loadBook(bookId, () => {
                    // Set the search navigator position
                    //
                    setSearchNavigator();
                    
                    $('#search').dialog('close');
                });
            }
        }
        
    } );

    //<script src="dictionary/z_search_pali_words.js"></ script>
    function Put(val) {
        var key = document.getElementById('key').value.trim();
        var pos = key.lastIndexOf(' ');
        if (pos != -1) {
            document.getElementById('key').value = key.substr(0, pos) + ' ' + val;
        } else {
            document.getElementById('key').value = val + ' ';
        }
        Start_Fuzzy();
    }

    function replacei(str, sub, f) {
        let A = str.toLowerCase().split(sub.toLowerCase());
        let B = [];
        let x = 0;
        for (let i = 0; i < A.length; i++) {
            let n = A[i].length;
            B.push(str.substr(x, n));
            if (i < A.length - 1)
                B.push(f(str.substr(x + n, sub.length)));
            x += n + sub.length;
        }
        return B.join('');
    }


    /////////////////////////////////////////
    ///////
    /////     DUPLICATE CODE TO BE MOVED TO TPPUTIL.JS FILE
    ////
    ////////////////////////
    function toUniRegEx(input) {
        if (!input || input == '') return input;
        var nigahita = 'ṃ';
        var Nigahita = 'Ṃ';

        input = input.replace(/\-.r/g, 'ṝ').replace(/\.r/g, 'ṛ').replace(/\.R/g, 'Ṛ');
        input = input.replace(/\-.l/g, 'ḹ').replace(/\.h/g, 'ḥ');
        input = input.replace(/\"S/g, 'Ś').replace(/\"s/g, 'ś').replace(/\.S/g, 'Ṣ').replace(/\.s/g, 'ṣ');
        input = input.replace(/ee/g, 'ē').replace(/oo/g, 'ō');

        input = input.replace(/\"n/g, 'ṅ').replace(/aa/g, 'ā').replace(/ii/g, 'ī').replace(/uu/g, 'ū').replace(/\.t/g, 'ṭ').replace(/\.d/g, 'ḍ').replace(/\"nk/g, 'ṅk').replace(/\"ng/g, 'ṅg').replace(/\.n/g, 'ṇ').replace(/\.m/g, nigahita).replace(/\u1E41/g, nigahita).replace(/\~n/g, 'ñ').replace(/\.l/g, 'ḷ').replace(/AA/g, 'Ā').replace(/II/g, 'Ī').replace(/UU/g, 'Ū').replace(/\.T/g, 'Ṭ').replace(/\.D/g, 'Ḍ').replace(/\"N/g, 'Ṅ').replace(/\.N/g, 'Ṇ').replace(/\.M/g, Nigahita).replace(/\~N/g, 'Ñ').replace(/\.L/g, 'Ḷ');
        return input;
    }

    function SetSelect() {
        var dsp = 'none';
        if (document.getElementById('SearchType1').checked == true) {
            dsp = 'inline';
        }
        for (i = 1; i <= 3; i++) {
            for (j = 1; j <= 8; j++) {
                no = '' + j + '' + i;
                document.getElementById('Nikaya' + no).style.display = dsp;
                document.getElementById('Out' + no).innerHTML = '';
            }
        }
        // document.getElementById('out').innerHTML = '';
    }

    function Jump(url) {
        html = url.substring(0, 4) + '.htm';
        id = url.substring(4);
        //document.write = localStorage.setItem('history_pos', '#R' + id);		// W=New Window, I=Jump ID
        window.open(html, '_blank');
    }


    pws = [];


    window.onload = function () {

        // new code to have all boxes checked.. search is fast so why not?
        //
        // maybe later we can save in local storage and check based on that.
        //document.getElementById('All').checked = true;
        //choosePali('All');
        // set the search dlg ResultsOnTOp to the localstorage

        var checked = false;
        var strChecked = localStorage.getItem("ShowOnTop");
        if (strChecked = "true") {checked = true;} 
        ShowOnTopClick(checked);
    }


    // load logo.
    //Logo is always NEEDED upon loading the user needs to see the
    // software title and the logo.  But crazy layout for main_td2.. needs work to work and should not 
    // be crazy..
    //getElementById("main_td2").innerHTML ='<a href="single.page.htm" id="asoka"><img src="images/asoka.png"></a>';


    // LoadPrefs  .. found in preferences.single.page.js
    //set the background color
    //when loading call
    initPreferences();
    function PrefTab(evt, tabname) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabname).style.display = "block";
    evt.currentTarget.className += " active";
}

    // this hides everything.. not sure why it is needed..should be hidden 
    // anyway.
    document.getElementById("defaultOpen").click();

    // when the prefsDialog closes call initPreferences()
    $('div#prefsDialog').on('dialogshow', function (event) {
        initPreferences();
    });
    $('div#prefsDialog').on('dialogclose', function (event) {
        initPreferences();
    });

    // add listener to go back when the escape key is pressed.
    window.addEventListener("keyup", function (e) {
        if (e.keyCode == 27) history.back();
    }, false);

    var hexToHSL = function hexToHSL(H) {
      // Convert hex to RGB first
      let r = 0, g = 0, b = 0;
      if (H.length == 4) {
        r = "0x" + H[1] + H[1];
        g = "0x" + H[2] + H[2];
        b = "0x" + H[3] + H[3];
      } else if (H.length == 7) {
        r = "0x" + H[1] + H[2];
        g = "0x" + H[3] + H[4];
        b = "0x" + H[5] + H[6];
      }
      // Then to HSL
      r /= 255;
      g /= 255;
      b /= 255;
      let cmin = Math.min(r,g,b),
          cmax = Math.max(r,g,b),
          delta = cmax - cmin,
          h = 0,
          s = 0,
          l = 0;

      if (delta == 0)
        h = 0;
      else if (cmax == r)
        h = ((g - b) / delta) % 6;
      else if (cmax == g)
        h = (b - r) / delta + 2;
      else
        h = (r - g) / delta + 4;

      h = Math.round(h * 60);

      if (h < 0)
        h += 360;

      l = (cmax + cmin) / 2;
      s = delta == 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));
      s = +(s * 100).toFixed(1);
      l = +(l * 100).toFixed(1);

      return {hue: h, saturation: s, lightness: l};
    };

    var ensureTextIsRedable = (backgroundColor, $element) => {
        const hsl = hexToHSL(backgroundColor);
        if (hsl.lightness > 50) {
            $element.css('color', '#000000');
        } else {
            $element.css('color', '#FFFfff');
        }
    };

    $(document).ready(function() {

        var $fontColorInput = $('#panel_font_color');
        $.farbtastic('#picker').linkTo(function(color) {
            ensureTextIsRedable(color, $fontColorInput);
            $fontColorInput.css('background-color', color);
            PanelFontColorChange(color);
        });

        var $backgroundColorInput = $('#panel_bg_color');
        $.farbtastic('#picker2').linkTo(function(color) {
            ensureTextIsRedable(color, $backgroundColorInput);
            $backgroundColorInput.css('background-color', color);
            PanelBGColorChange(color);
        });
        
        const colorInputs = [$fontColorInput, $backgroundColorInput];
        for (const $colorInput of colorInputs) {
            $colorInput.css('background-color', $colorInput.val());
            ensureTextIsRedable($colorInput.val(), $colorInput);
        }

        getCurrentVersion();

        onTabClick($('#page4')[0]);

  });

  function EnglishModeLoadEpub(bookid){
    var ViewRight =  localStorage.getItem("view_right");

    var filetoload = "";

    if (ViewRight == 'Suttacentral'){


        // buddhist legends and jatakaA will not match totally correct.
        // As they are epubs, we can re-arrange volumes to match pali volumes if we want.
        switch(bookid){
            case 1101:
                filetoload = "bod-1-parajika.epub";
                break;
            case 1102:
                filetoload = "bod-2-pacittiya.epub";
                break;
            case 1103:
                filetoload = "bod-3-mahavagga.epub";
                break;
            case 1104:
                filetoload = "bod-4-culavagga.epub";
                break;
            case 1105:
                filetoload = "bod-5-parivara.epub";
                break;
            case 2101:
            case 2102:
            case 2103:
                filetoload = "dn_en_sujato.epub";
                break;
            case 3101:
            case 3102:
            case 3103:
                filetoload = "mn_en_sujato.epub";
                break;
            case 4101:
            case 4102:
            case 4103:
            case 4104:
            case 4105:
                filetoload = "sn_en_sujato.epub";
                break;
            case 5101:
            case 5102:
            case 5103:
            case 5104:
            case 5105:
            case 5106:
            case 5107:
            case 5108:
            case 5109:
            case 5110:
            case 5111:
                filetoload = "an_en_sujato.epub";
                break;
            case 6108:
                filetoload = "thag_en_sujato.epub";
                break;
            case 6109:
                filetoload = "thig_en_sujato.epub";
                break;
            case 6202:
                filetoload = "Buddhist-Legends-1.epub";
                break;
            case 6203:
                filetoload = "Buddhist-Legends-2.epub";
                break;
            case 6217:
                filetoload = "JatakaVol.1,The-E.B.Cowell.epub";
                break;
            case 6218:
                filetoload = "JatakaVol.2,The-E.B.Cowell.epub";
                break;
            case 6219:
                filetoload = "JatakaVol.3,The-E.B.Cowell.epub";
                break;
            case 6220:
                filetoload = "JatakaVol.4,The-E.B.Cowell.epub";
                break;
            case 6221:
                filetoload = "JatakaVol.5,The-E.B.Cowell.epub";
                break;
            case 6222:
                filetoload = "JatakaVol.6,The-E.B.Cowell.epub";
                break;
            case 6223:
                filetoload = "JatakaVol.6,The-E.B.Cowell.epub";
                break;
            default:
                filetoload = "";
                break;
        }

        if (filetoload != ""){
            showDialog('#epub');
            $('#epub-selector').dialog('close');
            loadEpubBook(filetoload);
        }


    }

}



</script>


</body>
</html>
